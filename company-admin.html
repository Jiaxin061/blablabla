<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DblaFence - Admin</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="ai-chat-widget.css">
    <style>
        /* Admin Dashboard Specific Styles */
        .admin-header {
            background: #1d1d1f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .admin-header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .admin-title {
            font-size: 24px;
            font-weight: 600;
            color: #f5f5f7;
        }

        .admin-subtitle {
            font-size: 14px;
            color: #86868b;
            margin-top: 4px;
        }

        .admin-actions {
            display: flex;
            gap: 12px;
        }

        .admin-action-btn {
            background: #2d7aff;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .admin-action-btn:hover {
            background: #2260d2;
        }

        .admin-tabs {
            display: flex;
            margin-left: 32px;
        }

        .admin-tab {
            font-size: 16px;
            padding: 8px 16px;
            color: #f5f5f7;
            font-weight: 500;
            border-bottom: 2px solid #2d7aff;
        }

        .admin-tab.active {
            color: #f5f5f7;
            border-bottom: 2px solid #2d7aff;
        }

        /* Department Summary Styles */
        .department-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .department-card {
            background: #1d1d1f;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
        }

        .department-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .department-title {
            font-size: 18px;
            font-weight: 600;
            color: #f5f5f7;
        }

        .department-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
        }

        .stat-item {
            padding: 12px;
            background: #2c2c2e;
            border-radius: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #f5f5f7;
        }

        .stat-label {
            font-size: 12px;
            color: #86868b;
        }

        .status-good {
            color: #30d158;
        }

        .status-warning {
            color: #ffd60a;
        }

        .status-critical {
            color: #ff453a;
        }

        .team-members {
            margin-bottom: 24px;
        }

        .member-table {
            width: 100%;
            border-collapse: collapse;
            background: #1d1d1f;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .member-table th,
        .member-table td {
            padding: 16px;
            text-align: left;
        }

        .member-table th {
            background: #2c2c2e;
            color: #86868b;
            font-weight: 500;
            font-size: 14px;
        }

        .member-table tr:not(:last-child) {
            border-bottom: 1px solid #2c2c2e;
        }

        .member-table tbody tr {
            transition: background 0.2s;
        }

        .member-table tbody tr:hover {
            background: #2c2c2e;
        }

        .member-name {
            font-weight: 500;
            color: #f5f5f7;
        }

        .member-position {
            font-size: 12px;
            color: #86868b;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-indicator.good {
            background: #30d158;
        }

        .status-indicator.warning {
            background: #ffd60a;
        }

        .status-indicator.critical {
            background: #ff453a;
        }

        .member-issues {
            display: flex;
            gap: 8px;
        }

        .issue-badge {
            background: #2c2c2e;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #f5f5f7;
        }

        .action-button {
            padding: 6px 12px;
            border-radius: 6px;
            background: #2c2c2e;
            color: #f5f5f7;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 12px;
        }

        .action-button:hover {
            background: #3a3a3c;
        }

        .action-button.primary {
            background: #2d7aff;
        }

        .action-button.primary:hover {
            background: #2260d2;
        }

        .notifications-panel {
            background: #1d1d1f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .notifications-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .notification-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .notification-item {
            display: flex;
            padding: 16px;
            background: #2c2c2e;
            border-radius: 8px;
            border-left: 4px solid #2d7aff;
        }

        .notification-item.critical {
            border-left-color: #ff453a;
        }

        .notification-item.warning {
            border-left-color: #ffd60a;
        }

        .notification-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #3a3a3c;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 500;
            color: #f5f5f7;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 14px;
            color: #86868b;
            margin-bottom: 8px;
        }

        .notification-time {
            font-size: 12px;
            color: #86868b;
        }

        .notification-actions {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }

        /* Admin access key modal */
        .admin-key-modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .admin-key-modal .modal-content {
            background-color: #1d1d1f;
            padding: 24px;
            border-radius: 16px;
            width: 80%;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            margin: 0;
            transform: translateY(0);
        }
        
        .admin-key-modal .modal-title {
            font-size: 20px;
            font-weight: 600;
            color: #f5f5f7;
            margin-top: 0;
        }
        
        .action-button {
            background: #3a3a3c;
            color: #f5f5f7;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .action-button.primary {
            background: #2d7aff;
            color: white;
        }
        
        .action-button:hover {
            transform: translateY(-2px);
        }
        
        .action-button.primary:hover {
            background: #2260d2;
        }

        /* Search Bar Styles */
        .search-container {
            display: flex;
            background: #2c2c2e;
            border-radius: 8px;
            overflow: hidden;
            margin-right: 12px;
        }

        .search-input {
            background: transparent;
            border: none;
            padding: 8px 12px;
            color: #f5f5f7;
            min-width: 250px;
        }

        .search-input:focus {
            outline: none;
        }

        .search-button {
            background: transparent;
            border: none;
            padding: 10px 12px 6px 12px;
            color: #86868b;
            cursor: pointer;
        }
        
        .search-button img {
            filter: invert(50%) sepia(9%) saturate(360%) hue-rotate(182deg) brightness(90%) contrast(84%);
        }

        /* Overview Summary Cards */
        .overview-summary {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .summary-card {
            background: #1d1d1f;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .summary-icon {
            font-size: 24px;
            margin-bottom: 12px;
        }

        .summary-value {
            font-size: 28px;
            font-weight: 700;
            color: #f5f5f7;
            margin-bottom: 8px;
        }

        .summary-label {
            font-size: 14px;
            color: #86868b;
        }

        /* System Health Panel */
        .system-health-panel {
            background: #1d1d1f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            display: flex;
            align-items: center;
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #f5f5f7;
        }

        .panel-actions {
            display: flex;
            gap: 12px;
        }

        .refresh-btn {
            background: #2c2c2e;
            color: #f5f5f7;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .refresh-btn:hover {
            background: #3a3a3c;
        }

        .view-filter {
            background: #2c2c2e;
            color: #f5f5f7;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 12px;
            padding-right: 36px;
        }

        .health-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .device-card {
            display: flex;
            align-items: center;
            background: #2c2c2e;
            border-radius: 12px;
            padding: 16px;
            gap: 16px;
            border-left: 4px solid transparent;
        }

        .device-card.status-good {
            border-left-color: #30d158;
        }

        .device-card.status-warning {
            border-left-color: #ffd60a;
        }

        .device-card.status-critical {
            border-left-color: #ff453a;
        }

        .device-status {
            font-size: 20px;
            margin-right: 8px;
        }

        .device-info {
            flex: 1;
        }

        .device-name {
            font-weight: 500;
            color: #f5f5f7;
            margin-bottom: 4px;
        }

        .device-user {
            font-size: 12px;
            color: #86868b;
        }

        .device-stats {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .stat-tag {
            background: #3a3a3c;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            color: #f5f5f7;
        }

        .stat-tag.warning {
            color: #ffd60a;
            background: rgba(255, 214, 10, 0.1);
        }

        .stat-tag.critical {
            color: #ff453a;
            background: rgba(255, 69, 58, 0.1);
        }

        .view-more-link {
            text-align: center;
        }

        .view-more-link a {
            color: #2d7aff;
            text-decoration: none;
            font-size: 14px;
        }

        .view-more-link a:hover {
            text-decoration: underline;
        }

        /* Tab Content Styling */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Responsive Styles */
        @media (max-width: 1200px) {
            .overview-summary {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .health-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .overview-summary {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .health-grid {
                grid-template-columns: 1fr;
            }
            
            .admin-tabs {
                flex-wrap: wrap;
            }
        }

        /* Department Breakdown Styles */
        .department-breakdown {
            background: #1d1d1f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .dept-comparison {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .dept-card {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 16px;
        }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dept-name {
            font-weight: 600;
            color: #f5f5f7;
        }

        .dept-count {
            font-size: 12px;
            color: #86868b;
        }

        .dept-metrics {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .metric-item {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .metric-label {
            font-size: 12px;
            color: #86868b;
        }

        .progress-bar {
            height: 6px;
            background: #3a3a3c;
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #2d7aff;
            border-radius: 3px;
        }

        .metric-value {
            font-size: 12px;
            color: #f5f5f7;
            align-self: flex-end;
        }

        .metric-tags {
            display: flex;
            gap: 8px;
        }

        .metric-tag {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }

        .metric-tag.warning {
            color: #ffd60a;
            background: rgba(255, 214, 10, 0.1);
        }

        .metric-tag.critical {
            color: #ff453a;
            background: rgba(255, 69, 58, 0.1);
        }

        /* AI Suggestions Panel */
        .ai-suggestions-panel {
            background: #2c2c2e;
            border-radius: 12px;
            border: 1px solid #3d3d3f;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .suggestions-list {
            padding: 0 16px 16px;
            max-height: 320px;
            overflow-y: auto;
        }

        .suggestion-item {
            background: #3a3a3c;
            border-radius: 8px;
            margin-bottom: 12px;
            display: flex;
            transition: all 0.3s ease;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border-left: 3px solid #5e5e60;
        }

        .suggestion-item.urgent {
            border-left-color: #ff453a;
            box-shadow: 0 2px 10px rgba(255, 69, 58, 0.2);
        }

        .suggestion-priority {
            padding: 12px;
            writing-mode: vertical-lr;
            transform: rotate(180deg);
            text-align: center;
            font-weight: 600;
            font-size: 12px;
            min-width: 24px;
            background: #4c4c4e;
            color: #fff;
        }

        .suggestion-item.urgent .suggestion-priority {
            background: rgba(255, 69, 58, 0.2);
            color: #ff453a;
        }

        .suggestion-content {
            padding: 16px;
            flex-grow: 1;
        }

        .suggestion-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0 0 8px;
            color: #f5f5f7;
        }

        .suggestion-text {
            font-size: 14px;
            line-height: 1.4;
            color: #ebebf0;
            margin: 0 0 12px;
        }

        .affected-users {
            font-size: 13px;
            color: #aeaeb2;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .affected-label {
            color: #86868b;
        }

        .affected-count {
            background: rgba(255, 255, 255, 0.08);
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
        }

        .view-affected {
            color: #2d7aff;
            text-decoration: none;
            margin-left: auto;
        }

        .view-affected:hover {
            text-decoration: underline;
        }

        .suggestion-actions {
            display: flex;
            gap: 10px;
        }

        .action-button {
            background: #4c4c4e;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            font-size: 13px;
            color: #f5f5f7;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .action-button:hover {
            background: #5e5e60;
        }

        .action-button.primary {
            background: #2d7aff;
        }

        .action-button.primary:hover {
            background: #2662cc;
        }

        .no-suggestions {
            padding: 32px 16px;
            text-align: center;
            color: #86868b;
            font-size: 14px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            margin: 16px 0;
            border: 1px dashed #4c4c4e;
        }

        /* Priority colors for different suggestion types */
        .suggestion-item:nth-child(1):not(.urgent) .suggestion-priority {
            background: rgba(255, 159, 10, 0.2);
            color: #ff9f0a;
        }

        .suggestion-item:nth-child(2):not(.urgent) .suggestion-priority {
            background: rgba(48, 209, 88, 0.2);
            color: #30d158;
        }

        .suggestion-item:nth-child(3):not(.urgent) .suggestion-priority {
            background: rgba(94, 92, 230, 0.2);
            color: #5e5ce6;
        }

        /* Empty state animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .no-suggestions {
            animation: fadeIn 0.5s ease forwards;
        }

        /* Adding transition for smooth dismiss animation */
        .suggestion-item {
            opacity: 1;
            transform: translateX(0);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .suggestion-item.dismissing {
            opacity: 0;
            transform: translateX(-20px);
        }

        /* CSS Additions for Department Focus */
        .department-focus-section {
            background: #1d1d1f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .department-stats-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .department-filters {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-label {
            font-size: 14px;
            color: #86868b;
        }

        .department-comparison-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 24px;
        }

        .performance-metric {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 20px;
        }

        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .metric-title {
            font-size: 16px;
            font-weight: 600;
            color: #f5f5f7;
        }

        .dept-bar-chart {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .dept-bar {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dept-name-label {
            width: 100px;
            font-size: 14px;
            color: #f5f5f7;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .bar-container {
            flex: 1;
            height: 20px;
            background: #3a3a3c;
            border-radius: 4px;
            overflow: hidden;
        }

        .bar-fill {
            height: 100%;
            background: #2d7aff;
            border-radius: 4px 0 0 4px;
        }

        .bar-fill.good {
            background: #30d158;
        }

        .bar-fill.warning {
            background: #ffd60a;
        }

        .bar-fill.critical {
            background: #ff453a;
        }

        .bar-value {
            width: 40px;
            font-size: 14px;
            color: #f5f5f7;
            text-align: right;
        }

        .team-comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 24px;
        }

        .team-comparison-table th,
        .team-comparison-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #3a3a3c;
        }

        .team-comparison-table th {
            font-size: 14px;
            font-weight: 500;
            color: #86868b;
        }

        .team-comparison-table tbody tr:hover {
            background: #2c2c2e;
        }

        .team-name {
            font-weight: 500;
            color: #f5f5f7;
        }

        .team-department {
            font-size: 12px;
            color: #86868b;
        }

        .underperforming {
            position: relative;
        }

        .underperforming::after {
            content: '‚ö†Ô∏è';
            position: absolute;
            right: -20px;
            top: 50%;
            transform: translateY(-50%);
        }

        .dept-card.highlighted {
            border: 2px solid #ff453a;
            box-shadow: 0 0 15px rgba(255, 69, 58, 0.3);
        }

        .dept-card {
            position: relative;
            transition: all 0.2s ease;
        }

        .dept-card:hover {
            transform: translateY(-5px);
        }

        .dept-performance-indicator {
            position: absolute;
            top: 12px;
            right: 12px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .dept-performance-indicator.low {
            background: rgba(255, 69, 58, 0.2);
            color: #ff453a;
        }

        .dept-performance-indicator.medium {
            background: rgba(255, 214, 10, 0.2);
            color: #ffd60a;
        }

        .dept-performance-indicator.high {
            background: rgba(48, 209, 88, 0.2);
            color: #30d158;
        }

        /* Additional styles for enhanced department structure */
        .dept-structure-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 24px;
        }

        .dept-structure-card {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dept-structure-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .dept-teams-container {
            margin-top: 16px;
            border-top: 1px solid #3a3a3c;
            padding-top: 16px;
        }

        .dept-teams-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .dept-teams-header h5 {
            margin: 0;
            font-size: 14px;
            color: #86868b;
        }

        .action-button.small {
            padding: 4px 8px;
            font-size: 12px;
        }

        .dept-teams-list {
            background: #1d1d1f;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
        }

        .team-list-item {
            display: grid;
            grid-template-columns: 1.5fr 1fr 1fr 1.5fr;
            gap: 12px;
            padding: 12px;
            border-bottom: 1px solid #3a3a3c;
            font-size: 13px;
        }

        .team-list-item:last-child {
            border-bottom: none;
        }

        .team-list-item.underperforming {
            background: rgba(255, 69, 58, 0.1);
            border-left: 3px solid #ff453a;
            border-radius: 4px;
        }

        .team-list-name {
            font-weight: 500;
            color: #f5f5f7;
        }

        .team-list-members, .team-list-health, .team-list-issues {
            color: #d1d1d6;
        }

        .dept-actions {
            display: flex;
            gap: 8px;
            margin-top: 16px;
        }

        .dept-structure-card {
            background: #2c2c2e;
            border-radius: 12px;
            padding: 20px;
            position: relative;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .dept-structure-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }

        .dept-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 16px;
            padding-right: 36px; /* Add padding to prevent overlap with the indicator */
            position: relative;
        }

        .dept-name {
            font-weight: 600;
            color: #f5f5f7;
            margin: 0 0 8px 0;
            padding-right: 30px; /* Ensure text doesn't overlap with icon */
        }

        .dept-count {
            font-size: 12px;
            color: #86868b;
        }

        .dept-performance-indicator {
            position: absolute;
            top: 0;
            right: 0;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            z-index: 2; /* Ensure it's above other elements */
        }

        /* Department Summary Styles - Updated for top position */
        .department-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
            margin: 0 0 24px 0;
            background: #141414;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
        }

        .department-card {
            background: #1d1d1f;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            transition: all 0.3s ease;
            border-top: 3px solid #2d7aff;
        }

        .department-card:nth-child(1) {
            border-top-color: #30d158; /* Green for System Health */
        }

        .department-card:nth-child(2) {
            border-top-color: #5e5ce6; /* Purple for Performance */
        }

        .department-card:nth-child(3) {
            border-top-color: #ff9f0a; /* Orange for Updates & Security */
        }

        /* Add CSS for notification icon */
        .notification-icon-container {
            position: relative;
            margin-left: 16px;
            cursor: pointer;
        }
        
        .notification-bell {
            color: #f5f5f7;
            font-size: 18px;
            display: flex;
            align-items: center;
            padding: 8px;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .notification-bell:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .notification-badge {
            position: absolute;
            top: 0;
            right: 0;
            background-color: #ff453a;
            color: white;
            border-radius: 50%;
            width: 8px;
            height: 8px;
            display: block;
        }
        
        .notification-dropdown {
            position: absolute;
            top: 48px;
            right: 0;
            width: 360px;
            background-color: #1c1c1e;
            border-radius: 12px;
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            max-height: 480px;
            overflow-y: auto;
            display: none;
            border: 1px solid #2c2c2e;
        }
        
        .notification-dropdown.show {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dropdown-header {
            padding: 16px;
            border-bottom: 1px solid #2c2c2e;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .dropdown-title {
            font-weight: 600;
            color: #f5f5f7;
            font-size: 16px;
        }
        
        .mark-all-read {
            color: #0a84ff;
            font-size: 12px;
            cursor: pointer;
            background: none;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
        }
        
        .mark-all-read:hover {
            background-color: rgba(10, 132, 255, 0.1);
        }
        
        .header-notification-list {
            padding: 8px 0;
        }
        
        .header-notification-item {
            padding: 12px 16px;
            border-bottom: 1px solid #2c2c2e;
            display: flex;
            gap: 12px;
            transition: background-color 0.2s;
        }
        
        .header-notification-item:hover {
            background-color: #2c2c2e;
        }
        
        .header-notification-item.unread {
            background-color: rgba(10, 132, 255, 0.05);
        }
        
        .header-notification-item.unread:hover {
            background-color: rgba(10, 132, 255, 0.1);
        }
        
        .header-notification-icon {
            flex-shrink: 0;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background-color: #2c2c2e;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .header-notification-icon.critical {
            background-color: rgba(255, 69, 58, 0.1);
            color: #ff453a;
        }
        
        .header-notification-icon.warning {
            background-color: rgba(255, 214, 10, 0.1);
            color: #ffd60a;
        }
        
        .header-notification-content {
            flex: 1;
        }
        
        .header-notification-title {
            font-weight: 500;
            font-size: 14px;
            margin-bottom: 4px;
            color: #f5f5f7;
        }
        
        .header-notification-message {
            font-size: 12px;
            color: #86868b;
            line-height: 1.4;
        }
        
        .header-notification-time {
            font-size: 11px;
            color: #86868b;
            margin-top: 4px;
        }
        
        .view-all-notifications {
            display: block;
            text-align: center;
            padding: 12px;
            color: #0a84ff;
            text-decoration: none;
            font-size: 14px;
            border-top: 1px solid #2c2c2e;
        }
        
        .view-all-notifications:hover {
            background-color: rgba(10, 132, 255, 0.05);
        }
        
        /* Make sure navbar aligns items properly */
        header nav ul {
            display: flex;
            align-items: center;
        }

        /* Loading animation for refresh */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .refresh-btn {
            position: relative;
            padding-left: 24px;
            transition: all 0.2s ease;
        }

        .refresh-btn.loading {
            padding-left: 30px;
            pointer-events: none;
            opacity: 0.7;
        }

        .refresh-btn.loading::before {
            content: '';
            position: absolute;
            left: 8px;
            top: 50%;
            margin-top: -6px;
            width: 12px;
            height: 12px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        /* Animation for new suggestions */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .suggestion-item.new {
            animation: fadeInUp 0.4s ease forwards;
            opacity: 0;
        }

        .suggestion-item:nth-child(2).new {
            animation-delay: 0.1s;
        }

        .suggestion-item:nth-child(3).new {
            animation-delay: 0.2s;
        }

        .suggestion-timestamp {
            font-size: 11px;
            color: #86868b;
            margin-top: 2px;
            display: inline-block;
        }

        /* Badge counter for new suggestions */
        .suggestion-count {
            background: #ff453a;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 8px;
            display: inline-flex;
            align-items: center;
            height: 18px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Panel header layout improvements */
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .panel-title {
            display: flex;
            align-items: center;
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: #f5f5f7;
        }

        /* Loading state for the suggestions list */
        .suggestions-list.loading {
            position: relative;
            min-height: 200px;
        }

        .suggestions-list.loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #2d7aff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .suggestions-list.loading .suggestion-item,
        .suggestions-list.loading .no-suggestions {
            opacity: 0.5;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="images/DblaFence_logo.png" alt="DblaFence Logo" style="height: 48px; margin-right: 16px;">
            </div>
            <nav>
                <ul>
                    <li><a href="company-dashboard.html">Dashboard</a></li>
                    <li><a href="company-reports.html">Reports</a></li>
                    <li><a href="#" id="adminLink" class="restricted-link" onclick="checkAdminAccess(event)">Admin <span class="lock-icon">üîí</span></a></li>
                    <li><a href="company-settings.html">Settings</a></li>
                    <li><a href="company-support.html">Support</a></li>
                    <li><a href="#" class="logout-btn" onclick="handleLogout()">Logout</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="container">
        <div class="admin-header">
            <div class="admin-header-content">
                <div>
                    <h2 class="admin-title">Department Management</h2>
                    <p class="admin-subtitle">Department Performance Analysis ‚Ä¢ Team Comparison</p>
                </div>
                <div class="admin-actions">
                    <div class="notification-icon-container" id="notificationBell" style="margin-right: 16px;">
                        <div class="notification-bell">
                            <p>üîî</p>
                        </div>
                        <span class="notification-badge"></span>
                        
                        <div class="notification-dropdown" id="notificationDropdown">
                            <div class="dropdown-header">
                                <div class="dropdown-title">Notifications</div>
                                <button class="mark-all-read">Mark all as read</button>
                            </div>
                            <div class="header-notification-list">
                                <div class="header-notification-item unread">
                                    <div class="header-notification-icon critical">‚ö†Ô∏è</div>
                                    <div class="header-notification-content">
                                        <div class="header-notification-title">Critical Issue Detected</div>
                                        <div class="header-notification-message">Alex Johnson's system is experiencing high memory usage (92%) and CPU throttling.</div>
                                        <div class="header-notification-time">10 minutes ago</div>
                                    </div>
                                </div>
                                <div class="header-notification-item unread">
                                    <div class="header-notification-icon warning">‚ö†Ô∏è</div>
                                    <div class="header-notification-content">
                                        <div class="header-notification-title">Multiple Updates Pending</div>
                                        <div class="header-notification-message">5 team members have critical security updates pending for more than 7 days.</div>
                                        <div class="header-notification-time">2 hours ago</div>
                                    </div>
                                </div>
                                <div class="header-notification-item">
                                    <div class="header-notification-icon">üìä</div>
                                    <div class="header-notification-content">
                                        <div class="header-notification-title">Weekly Department Report</div>
                                        <div class="header-notification-message">Engineering department report ready to view.</div>
                                        <div class="header-notification-time">Yesterday</div>
                                    </div>
                                </div>
                            </div>
                            <a href="#overview-tab" class="view-all-notifications" onclick="switchTab('overview'); document.getElementById('notificationDropdown').classList.remove('show');">View all notifications</a>
                        </div>
                    </div>
                    <div class="search-container">
                        <input type="text" class="search-input" placeholder="Search departments or teams...">
                        <button class="search-button">
                            <img src="images/search-svgrepo-com.svg" alt="Search" width="16" height="16">
                        </button>
                    </div>
                    <button class="admin-action-btn" id="exportReportBtn">
                        <span>Export Department Report</span>
                    </button>
                </div>
            </div>
            
        </div>

        <div class="department-summary">
            <div class="department-card">
                <div class="department-header">
                    <h3 class="department-title">System Health</h3>
                </div>
                <div class="department-stats">
                    <div class="stat-item">
                        <div class="stat-value status-good">18</div>
                        <div class="stat-label">Healthy Systems</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value status-warning">4</div>
                        <div class="stat-label">Warning Systems</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value status-critical">2</div>
                        <div class="stat-label">Critical Systems</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">75%</div>
                        <div class="stat-label">Avg. Health Score</div>
                    </div>
                </div>
            </div>

            <div class="department-card">
                <div class="department-header">
                    <h3 class="department-title">Performance</h3>
                </div>
                <div class="department-stats">
                    <div class="stat-item">
                        <div class="stat-value">42%</div>
                        <div class="stat-label">Avg. CPU Usage</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">58%</div>
                        <div class="stat-label">Avg. Memory Usage</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">99.7%</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">32</div>
                        <div class="stat-label">Open Issues</div>
                    </div>
                </div>
            </div>

            <div class="department-card">
                <div class="department-header">
                    <h3 class="department-title">Updates & Security</h3>
                </div>
                <div class="department-stats">
                    <div class="stat-item">
                        <div class="stat-value status-warning">12</div>
                        <div class="stat-label">Pending Updates</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value status-critical">3</div>
                        <div class="stat-label">Security Alerts</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value">87%</div>
                        <div class="stat-label">Security Score</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value status-good">22</div>
                        <div class="stat-label">Up-to-date Systems</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Overview Summary Dashboard -->
        <div class="tab-content" id="overview-tab">
            <!-- Removed notifications panel from here -->
            
            <!-- Department Focus Dashboard -->
            <div class="department-focus-section">
                <div class="department-stats-header">
                    <h3 class="panel-title">Department Performance Overview</h3>
                    <div class="department-filters">
                        <span class="filter-label">View by:</span>
                        <select class="view-filter" id="departmentFilter">
                            <option value="all">All Departments</option>
                            <option value="engineering">Engineering</option>
                            <option value="design">Design</option>
                            <option value="marketing">Marketing</option>
                            <option value="sales">Sales</option>
                            <option value="support">Support</option>
                        </select>
                        <select class="view-filter" id="metricFilter">
                            <option value="health">Health Score</option>
                            <option value="issues">Issue Count</option>
                            <option value="performance">Performance</option>
                            <option value="updates">Pending Updates</option>
                        </select>
                        <button class="refresh-btn">Apply Filters</button>
                </div>
                </div>
                
                <div class="department-comparison-grid">
                    <div class="performance-metric">
                        <div class="metric-header">
                            <div class="metric-title">Health Score by Department</div>
                </div>
                        <div class="dept-bar-chart">
                            <div class="dept-bar">
                                <div class="dept-name-label">Engineering</div>
                                <div class="bar-container">
                                    <div class="bar-fill warning" style="width: 75%"></div>
                </div>
                                <div class="bar-value">75%</div>
                            </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Design</div>
                                <div class="bar-container">
                                    <div class="bar-fill good" style="width: 82%"></div>
                                </div>
                                <div class="bar-value">82%</div>
                            </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Marketing</div>
                                <div class="bar-container">
                                    <div class="bar-fill good" style="width: 91%"></div>
                                </div>
                                <div class="bar-value">91%</div>
                            </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Sales</div>
                                <div class="bar-container">
                                    <div class="bar-fill good" style="width: 87%"></div>
                                </div>
                                <div class="bar-value">87%</div>
                            </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Support</div>
                                <div class="bar-container">
                                    <div class="bar-fill critical" style="width: 68%"></div>
                                </div>
                                <div class="bar-value">68%</div>
                            </div>
                </div>
            </div>

                    <div class="performance-metric">
                        <div class="metric-header">
                            <div class="metric-title">Critical Issues by Department</div>
                    </div>
                        <div class="dept-bar-chart">
                            <div class="dept-bar">
                                <div class="dept-name-label">Engineering</div>
                                <div class="bar-container">
                                    <div class="bar-fill critical" style="width: 60%"></div>
                </div>
                                <div class="bar-value">6</div>
                        </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Design</div>
                                <div class="bar-container">
                                    <div class="bar-fill warning" style="width: 20%"></div>
                        </div>
                                <div class="bar-value">2</div>
                    </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Marketing</div>
                                <div class="bar-container">
                                    <div class="bar-fill good" style="width: 0%"></div>
                        </div>
                                <div class="bar-value">0</div>
                        </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Sales</div>
                                <div class="bar-container">
                                    <div class="bar-fill warning" style="width: 10%"></div>
                    </div>
                                <div class="bar-value">1</div>
                        </div>
                            <div class="dept-bar">
                                <div class="dept-name-label">Support</div>
                                <div class="bar-container">
                                    <div class="bar-fill critical" style="width: 40%"></div>
                        </div>
                                <div class="bar-value">4</div>
                    </div>
                </div>
                </div>
            </div>

                <!-- Enhanced Department Structure Overview -->
                <h3 class="panel-title">Department Structure & Performance Overview</h3>
                <div class="department-filters" style="margin-bottom: 16px;">
                    <select class="view-filter" id="deptStructureFilter">
                        <option value="all">All Departments</option>
                        <option value="engineering">Engineering</option>
                        <option value="design">Design</option>
                        <option value="marketing">Marketing</option>
                        <option value="sales">Sales</option>
                        <option value="support">Support</option>
                        </select>
                    <select class="view-filter" id="deptViewType">
                        <option value="performance">Performance View</option>
                        <option value="structure">Structure View</option>
                        <option value="issues">Issues View</option>
                    </select>
                    <button class="refresh-btn" id="refreshDeptView">Update View</button>
                    </div>
                
                <div class="dept-structure-grid">
                    <!-- Engineering Department -->
                    <div class="dept-structure-card highlighted">
                        <div class="dept-performance-indicator low">!</div>
                        <div class="dept-header">
                            <div>
                            <h4 class="dept-name">Engineering</h4>
                                <div class="dept-count">24 devices ‚Ä¢ 4 teams ‚Ä¢ 19 employees</div>
                            </div>
                        </div>
                        <div class="dept-metrics">
                            <div class="metric-item">
                                <div class="metric-label">Health Score</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 75%"></div>
                                </div>
                                <div class="metric-value">75% <span class="status-warning">‚ñº 3%</span></div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Issues</div>
                                <div class="metric-tags">
                                    <span class="metric-tag critical">6 Critical</span>
                                    <span class="metric-tag warning">12 Warning</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Teams within department -->
                        <div class="dept-teams-container">
                            <div class="dept-teams-header">
                                <h5>Teams</h5>
                                <button class="action-button small" onclick="toggleTeamsList('engineering')">
                                    <span id="engineering-teams-toggle">Show Teams</span>
                                </button>
                    </div>
                            <div class="dept-teams-list" id="engineering-teams" style="display: none;">
                                <div class="team-list-item underperforming">
                                    <div class="team-list-name">Backend Team</div>
                                    <div class="team-list-members">8 members</div>
                                    <div class="team-list-health">65% <span class="status-critical">‚ñº 7%</span></div>
                                    <div class="team-list-issues">4 critical, 7 warnings</div>
                                </div>
                                <div class="team-list-item">
                                    <div class="team-list-name">Frontend Team</div>
                                    <div class="team-list-members">6 members</div>
                                    <div class="team-list-health">79% <span class="status-warning">‚ñº 2%</span></div>
                                    <div class="team-list-issues">1 critical, 3 warnings</div>
                                </div>
                                <div class="team-list-item">
                                    <div class="team-list-name">DevOps Team</div>
                                    <div class="team-list-members">5 members</div>
                                    <div class="team-list-health">82% <span class="status-good">‚ñ≤ 1%</span></div>
                                    <div class="team-list-issues">0 critical, 2 warnings</div>
                                </div>
                            </div>
                        </div>
                        <div class="dept-actions">
                            <button class="action-button primary">View Department Details</button>
                        </div>
                    </div>
                    
                    <!-- Design Department -->
                    <div class="dept-structure-card">
                        <div class="dept-performance-indicator high">‚úì</div>
                        <div class="dept-header">
                            <div>
                            <h4 class="dept-name">Design</h4>
                                <div class="dept-count">12 devices ‚Ä¢ 2 teams ‚Ä¢ 12 employees</div>
                            </div>
                        </div>
                        <div class="dept-metrics">
                            <div class="metric-item">
                                <div class="metric-label">Health Score</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 82%"></div>
                                </div>
                                <div class="metric-value">82% <span class="status-good">‚ñ≤ 2%</span></div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Issues</div>
                                <div class="metric-tags">
                                    <span class="metric-tag critical">2 Critical</span>
                                    <span class="metric-tag warning">5 Warning</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Teams within department -->
                        <div class="dept-teams-container">
                            <div class="dept-teams-header">
                                <h5>Teams</h5>
                                <button class="action-button small" onclick="toggleTeamsList('design')">
                                    <span id="design-teams-toggle">Show Teams</span>
                                </button>
                    </div>
                            <div class="dept-teams-list" id="design-teams" style="display: none;">
                                <div class="team-list-item">
                                    <div class="team-list-name">UI Design Team</div>
                                    <div class="team-list-members">7 members</div>
                                    <div class="team-list-health">84% <span class="status-good">‚ñ≤ 3%</span></div>
                                    <div class="team-list-issues">1 critical, 3 warnings</div>
                                </div>
                                <div class="team-list-item">
                                    <div class="team-list-name">UX Research Team</div>
                                    <div class="team-list-members">5 members</div>
                                    <div class="team-list-health">79% <span class="status-warning">‚ñº 1%</span></div>
                                    <div class="team-list-issues">1 critical, 2 warnings</div>
                                </div>
                            </div>
                        </div>
                        <div class="dept-actions">
                            <button class="action-button primary">View Department Details</button>
                        </div>
                    </div>
                    
                    <!-- Marketing Department -->
                    <div class="dept-structure-card">
                        <div class="dept-performance-indicator high">‚úì</div>
                        <div class="dept-header">
                            <div>
                            <h4 class="dept-name">Marketing</h4>
                                <div class="dept-count">8 devices ‚Ä¢ 2 teams ‚Ä¢ 10 employees</div>
                            </div>
                        </div>
                        <div class="dept-metrics">
                            <div class="metric-item">
                                <div class="metric-label">Health Score</div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: 91%"></div>
                                </div>
                                <div class="metric-value">91% <span class="status-good">‚ñ≤ 4%</span></div>
                            </div>
                            <div class="metric-item">
                                <div class="metric-label">Issues</div>
                                <div class="metric-tags">
                                    <span class="metric-tag critical">0 Critical</span>
                                    <span class="metric-tag warning">3 Warning</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Teams within department -->
                        <div class="dept-teams-container">
                            <div class="dept-teams-header">
                                <h5>Teams</h5>
                                <button class="action-button small" onclick="toggleTeamsList('marketing')">
                                    <span id="marketing-teams-toggle">Show Teams</span>
                                </button>
                    </div>
                            <div class="dept-teams-list" id="marketing-teams" style="display: none;">
                                <div class="team-list-item">
                                    <div class="team-list-name">Digital Marketing</div>
                                    <div class="team-list-members">6 members</div>
                                    <div class="team-list-health">93% <span class="status-good">‚ñ≤ 5%</span></div>
                                    <div class="team-list-issues">0 critical, 1 warning</div>
                </div>
                                <div class="team-list-item">
                                    <div class="team-list-name">Content Creation</div>
                                    <div class="team-list-members">4 members</div>
                                    <div class="team-list-health">88% <span class="status-good">‚ñ≤ 2%</span></div>
                                    <div class="team-list-issues">0 critical, 2 warnings</div>
                                </div>
                            </div>
                        </div>
                        <div class="dept-actions">
                            <button class="action-button primary">View Department Details</button>
                        </div>
                </div>
                </div>

                <!-- Team Performance Table -->
                <h3 class="panel-title" style="margin-top: 24px;">Team Performance Comparison</h3>
                <div class="team-filters" style="margin-bottom: 12px;">
                    <select class="view-filter" id="teamDeptFilter">
                        <option value="all">All Departments</option>
                        <option value="engineering">Engineering</option>
                        <option value="design">Design</option>
                        <option value="marketing">Marketing</option>
                    </select>
                    <select class="view-filter" id="teamSortFilter">
                        <option value="health-asc">Health Score (Low to High)</option>
                        <option value="health-desc">Health Score (High to Low)</option>
                        <option value="issues-desc">Most Issues</option>
                        <option value="issues-asc">Least Issues</option>
                    </select>
                </div>
                <table class="team-comparison-table">
                    <thead>
                        <tr>
                            <th>Team</th>
                            <th>Department</th>
                            <th>Members</th>
                            <th>Health Score</th>
                            <th>Critical Issues</th>
                            <th>Warning Issues</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr class="underperforming">
                            <td>
                                <div class="team-name">Backend Team</div>
                            </td>
                            <td>
                                <div class="team-department">Engineering</div>
                            </td>
                            <td>8</td>
                            <td>65%</td>
                            <td class="status-critical">4</td>
                            <td class="status-warning">7</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="team-name">Frontend Team</div>
                            </td>
                            <td>
                                <div class="team-department">Engineering</div>
                            </td>
                            <td>6</td>
                            <td>79%</td>
                            <td class="status-critical">1</td>
                            <td class="status-warning">3</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="team-name">DevOps Team</div>
                            </td>
                            <td>
                                <div class="team-department">Engineering</div>
                            </td>
                            <td>5</td>
                            <td>82%</td>
                            <td class="status-critical">0</td>
                            <td class="status-warning">2</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="team-name">QA Team</div>
                            </td>
                            <td>
                                <div class="team-department">Engineering</div>
                            </td>
                            <td>5</td>
                            <td>77%</td>
                            <td class="status-critical">1</td>
                            <td class="status-warning">4</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="team-name">UI Design Team</div>
                            </td>
                            <td>
                                <div class="team-department">Design</div>
                            </td>
                            <td>7</td>
                            <td>84%</td>
                            <td class="status-critical">1</td>
                            <td class="status-warning">3</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                        <tr>
                            <td>
                                <div class="team-name">UX Research Team</div>
                            </td>
                            <td>
                                <div class="team-department">Design</div>
                            </td>
                            <td>5</td>
                            <td>79%</td>
                            <td class="status-critical">1</td>
                            <td class="status-warning">2</td>
                            <td>
                                <button class="action-button primary">View Details</button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Department Breakdown -->
            <div class="department-breakdown" style="display: none;">
                <!-- Content has been moved to combined section above -->
            </div>

            <!-- AI Suggestions Panel -->
            <div class="ai-suggestions-panel card">
                <div class="panel-header">
                    <h3 class="panel-title">AI Suggestions</h3>
                    <div class="panel-actions">
                        <button class="refresh-btn">Refresh</button>
                    </div>
                </div>
                <div class="suggestions-list">
                    <div class="suggestion-item urgent">
                        <div class="suggestion-priority">URGENT</div>
                        <div class="suggestion-content">
                            <h4 class="suggestion-title">Device Overheating Issues</h4>
                            <p class="suggestion-text">7 devices are overheating consistently. Recommend applying system cooling patch or changing performance mode to Balanced.</p>
                            <div class="affected-users">
                                <span class="affected-label">Affected users:</span>
                                <span class="affected-count">7</span>
                                <a href="#" class="view-affected">View list</a>
                            </div>
                            <div class="suggestion-actions">
                                <button class="action-button primary">Apply Recommendation</button>
                                <button class="action-button">Dismiss</button>
                            </div>
                        </div>
                    </div>
                    <div class="suggestion-item">
                        <div class="suggestion-priority">HIGH</div>
                        <div class="suggestion-content">
                            <h4 class="suggestion-title">Security Update Deployment</h4>
                            <p class="suggestion-text">12 devices have critical security updates pending for more than 5 days. Schedule deployment during non-working hours.</p>
                            <div class="affected-users">
                                <span class="affected-label">Affected users:</span>
                                <span class="affected-count">12</span>
                                <a href="#" class="view-affected">View list</a>
                            </div>
                            <div class="suggestion-actions">
                                <button class="action-button primary">Schedule Updates</button>
                                <button class="action-button">Dismiss</button>
                            </div>
                        </div>
                    </div>
                    <div class="suggestion-item">
                        <div class="suggestion-priority">MEDIUM</div>
                        <div class="suggestion-content">
                            <h4 class="suggestion-title">Performance Optimization</h4>
                            <p class="suggestion-text">Design department shows consistently high resource usage during midday. Consider staggering resource-intensive tasks or upgrading RAM on affected machines.</p>
                            <div class="affected-users">
                                <span class="affected-label">Affected users:</span>
                                <span class="affected-count">5</span>
                                <a href="#" class="view-affected">View list</a>
                            </div>
                            <div class="suggestion-actions">
                                <button class="action-button primary">Review Details</button>
                                <button class="action-button">Dismiss</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                <div class="card" style="margin-top: 32px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; ">
                        <div style="font-size: 18px; font-weight: 600; color: #f5f5f7;">Vendor Sync & Updates</div>
            </div>

                    <div style="background: #2c2c2e; border-radius: 12px; overflow: hidden;">
                        <table style="width: 100%; border-collapse: collapse; color: #f5f5f7;">
                <thead>
                                <tr style="background: #3a3a3c; text-align: left;">
                                    <th style="padding: 16px; font-weight: 500;">Software</th>
                                    <th style="padding: 16px; font-weight: 500;">Current Version</th>
                                    <th style="padding: 16px; font-weight: 500;">Latest Version</th>
                                    <th style="padding: 16px; font-weight: 500;">Affected Devices</th>
                                    <th style="padding: 16px; font-weight: 500;">Priority</th>
                                    <th style="padding: 16px; font-weight: 500;">Type</th>
                                    <th style="padding: 16px; font-weight: 500;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                                <tr style="border-bottom: 1px solid #3a3a3c;">
                                    <td style="padding: 16px; display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 32px; height: 32px; background: #0078d7; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">W</div>
                                        Windows OS
                        </td>
                                    <td style="padding: 16px;">10.0.19044</td>
                                    <td style="padding: 16px;">10.0.19045</td>
                                    <td style="padding: 16px;">18</td>
                                    <td style="padding: 16px;">
                                        <span style="display: inline-block; padding: 4px 10px; background: rgba(255, 69, 58, 0.1); color: #ff453a; border-radius: 12px; font-size: 12px;">High</span>
                        </td>
                                    <td style="padding: 16px;">Security</td>
                                    <td style="padding: 16px;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="deployUpdate('Windows OS', '10.0.19045', 18, 'Security')" style="background: #2d7aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Deploy</button>
                                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Details</button>
                            </div>
                        </td>
                    </tr>
                                <tr style="border-bottom: 1px solid #3a3a3c;">
                                    <td style="padding: 16px; display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 32px; height: 32px; background: #f25022; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">O</div>
                                        Microsoft Office
                        </td>
                                    <td style="padding: 16px;">16.0.14931</td>
                                    <td style="padding: 16px;">16.0.15128</td>
                                    <td style="padding: 16px;">32</td>
                                    <td style="padding: 16px;">
                                        <span style="display: inline-block; padding: 4px 10px; background: rgba(255, 214, 10, 0.1); color: #ffd60a; border-radius: 12px; font-size: 12px;">Medium</span>
                        </td>
                                    <td style="padding: 16px;">Feature</td>
                                    <td style="padding: 16px;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="deployUpdate('Microsoft Office', '16.0.15128', 32, 'Feature')" style="background: #2d7aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Deploy</button>
                                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Details</button>
                            </div>
                        </td>
                    </tr>
                                <tr style="border-bottom: 1px solid #3a3a3c;">
                                    <td style="padding: 16px; display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 32px; height: 32px; background: #5e5e5e; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">A</div>
                                        Adobe Creative Cloud
                        </td>
                                    <td style="padding: 16px;">5.6.0.788</td>
                                    <td style="padding: 16px;">5.7.0.102</td>
                                    <td style="padding: 16px;">9</td>
                                    <td style="padding: 16px;">
                                        <span style="display: inline-block; padding: 4px 10px; background: rgba(48, 209, 88, 0.1); color: #30d158; border-radius: 12px; font-size: 12px;">Low</span>
                        </td>
                                    <td style="padding: 16px;">Stability</td>
                                    <td style="padding: 16px;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="deployUpdate('Adobe Creative Cloud', '5.7.0.102', 9, 'Stability')" style="background: #2d7aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Deploy</button>
                                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Details</button>
                            </div>
                        </td>
                    </tr>
                                <tr style="border-bottom: 1px solid #3a3a3c;">
                                    <td style="padding: 16px; display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 32px; height: 32px; background: #4285f4; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">C</div>
                                        Chrome Browser
                        </td>
                                    <td style="padding: 16px;">112.0.5615.138</td>
                                    <td style="padding: 16px;">113.0.5672.93</td>
                                    <td style="padding: 16px;">42</td>
                                    <td style="padding: 16px;">
                                        <span style="display: inline-block; padding: 4px 10px; background: rgba(255, 69, 58, 0.1); color: #ff453a; border-radius: 12px; font-size: 12px;">High</span>
                        </td>
                                    <td style="padding: 16px;">Security</td>
                                    <td style="padding: 16px;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="deployUpdate('Chrome Browser', '113.0.5672.93', 42, 'Security')" style="background: #2d7aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Deploy</button>
                                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Details</button>
                            </div>
                        </td>
                    </tr>
                    <tr>
                                    <td style="padding: 16px; display: flex; align-items: center; gap: 12px;">
                                        <div style="width: 32px; height: 32px; background: #00adef; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">Z</div>
                                        Zoom Meetings
                        </td>
                                    <td style="padding: 16px;">5.13.5</td>
                                    <td style="padding: 16px;">5.14.0</td>
                                    <td style="padding: 16px;">38</td>
                                    <td style="padding: 16px;">
                                        <span style="display: inline-block; padding: 4px 10px; background: rgba(255, 214, 10, 0.1); color: #ffd60a; border-radius: 12px; font-size: 12px;">Medium</span>
                        </td>
                                    <td style="padding: 16px;">Feature</td>
                                    <td style="padding: 16px;">
                                        <div style="display: flex; gap: 8px;">
                                            <button onclick="deployUpdate('Zoom Meetings', '5.14.0', 38, 'Feature')" style="background: #2d7aff; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Deploy</button>
                                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Details</button>
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
                    </div>
        </div>

        <!-- Reports & Exports Modal -->
        <div class="admin-key-modal" id="reportExportModal" style="display: none;">
            <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 class="modal-title">Department Report Generator</h3>
                    <button onclick="closeReportModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            </div>

                <div style="display: flex; gap: 24px; flex-wrap: wrap;">
                    <!-- Report Templates -->
                    <div style="flex: 1; min-width: 300px; background: #2c2c2e; border-radius: 12px; padding: 24px;">
                        <div style="font-size: 18px; font-weight: 600; color: #f5f5f7; margin-bottom: 16px;">Report Templates</div>
                        <p style="font-size: 14px; color: #86868b; margin-bottom: 24px;">Select a template to automatically configure report settings</p>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px;" id="reportTemplateGrid">
                            <!-- System Health Report -->
                            <div class="report-template-card" data-report-type="health" style="background: #3a3a3c; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                                <div class="template-icon" style="background: rgba(255, 159, 10, 0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                    <img src="https://cdn-icons-png.flaticon.com/512/7515/7515011.png" alt="System Health" style="width: 32px; height: 32px; filter: invert(1);">
                        </div>
                                <div style="position: absolute; top: 0; right: 0; padding: 8px; display: none;" class="selected-indicator">
                                    <span style="background: #2d7aff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">‚úì</span>
                    </div>
                                <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 8px;">System Health Report</div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 16px;">Complete overview of all system metrics and performance indicators</div>
                                <div class="template-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(255, 159, 10, 0.2); padding: 4px 8px; border-radius: 12px;">Diagnostics</span>
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(255, 159, 10, 0.2); padding: 4px 8px; border-radius: 12px;">Performance</span>
                </div>
                        </div>

                            <!-- Device Usage Report -->
                            <div class="report-template-card" data-report-type="usage" style="background: #3a3a3c; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                                <div class="template-icon" style="background: rgba(48, 209, 88, 0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                    <img src="https://cdn-icons-png.flaticon.com/512/2972/2972531.png" alt="Device Usage" style="width: 32px; height: 32px; filter: invert(1);">
                    </div>
                                <div style="position: absolute; top: 0; right: 0; padding: 8px; display: none;" class="selected-indicator">
                                    <span style="background: #2d7aff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">‚úì</span>
                </div>
                                <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 8px;">Device Usage Report</div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 16px;">Detailed usage statistics for all devices and applications</div>
                                <div class="template-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(48, 209, 88, 0.2); padding: 4px 8px; border-radius: 12px;">Statistics</span>
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(48, 209, 88, 0.2); padding: 4px 8px; border-radius: 12px;">Utilization</span>
                        </div>
                    </div>
                            
                            <!-- Alert History Report -->
                            <div class="report-template-card" data-report-type="alerts" style="background: #3a3a3c; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden;">
                                <div class="template-icon" style="background: rgba(255, 69, 58, 0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1827/1827379.png" alt="Alert History" style="width: 32px; height: 32px; filter: invert(1);">
                </div>
                                <div style="position: absolute; top: 0; right: 0; padding: 8px; display: none;" class="selected-indicator">
                                    <span style="background: #2d7aff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">‚úì</span>
                                </div>
                                <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 8px;">Alert History Report</div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 16px;">Complete log of all alerts and incidents with resolution status</div>
                                <div class="template-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(255, 69, 58, 0.2); padding: 4px 8px; border-radius: 12px;">Security</span>
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(255, 69, 58, 0.2); padding: 4px 8px; border-radius: 12px;">Incidents</span>
                </div>
            </div>

                            <!-- Department Summary -->
                            <div class="report-template-card selected" data-report-type="department" style="background: #3a3a3c; border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; border: 2px solid #2d7aff; box-shadow: 0 0 15px rgba(45, 122, 255, 0.3);">
                                <div class="template-icon" style="background: rgba(10, 132, 255, 0.1); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-bottom: 16px;">
                                    <img src="https://cdn-icons-png.flaticon.com/512/1570/1570887.png" alt="Department Summary" style="width: 32px; height: 32px; filter: invert(1);">
                </div>
                                <div style="position: absolute; top: 0; right: 0; padding: 8px; display: block;" class="selected-indicator">
                                    <span style="background: #2d7aff; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; color: white; font-size: 12px;">‚úì</span>
                    </div>
                                <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 8px;">Department Summary</div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 16px;">Comparative analysis of departments and teams performance</div>
                                <div class="template-tags" style="display: flex; gap: 4px; flex-wrap: wrap;">
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(10, 132, 255, 0.2); padding: 4px 8px; border-radius: 12px;">Analytics</span>
                                    <span style="font-size: 11px; color: #f5f5f7; background: rgba(10, 132, 255, 0.2); padding: 4px 8px; border-radius: 12px;">Comparison</span>
                    </div>
                    </div>
                    </div>
                </div>
                    
                    <!-- Report Generation -->
                    <div style="flex: 1; background: #2c2c2e; border-radius: 12px; padding: 24px; min-width: 300px;">
                        <div style="font-size: 18px; font-weight: 600; color: #f5f5f7; margin-bottom: 24px;">Generate Custom Report</div>
                        
                        <div style="display: flex; flex-direction: column; gap: 16px;">
                            <div>
                                <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Report Type</label>
                                <select id="reportTypeSelect" style="width: 100%; padding: 12px; border-radius: 8px; border: none; background: #3a3a3c; color: #f5f5f7;">
                                    <option value="health">System Health Report</option>
                                    <option value="usage">Device Usage Report</option>
                                    <option value="alerts">Alert History Report</option>
                                    <option value="department" selected>Department Summary</option>
                                    <option value="custom">Custom Report</option>
                                </select>
            </div>
                            
                            <div>
                                <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Time Period</label>
                                <select id="reportTimePeriod" style="width: 100%; padding: 12px; border-radius: 8px; border: none; background: #3a3a3c; color: #f5f5f7;">
                                    <option value="day">Last 24 Hours</option>
                                    <option value="week">Last 7 Days</option>
                                    <option value="month" selected>Last 30 Days</option>
                                    <option value="quarter">Last Quarter</option>
                                    <option value="year">Last Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
        </div>

                            <div>
                                <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Include Departments</label>
                                <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                    <div style="display: flex; align-items: center; background: #3a3a3c; padding: 8px 12px; border-radius: 6px;">
                                        <input type="checkbox" id="all-dept" checked style="margin-right: 8px;">
                                        <label for="all-dept" style="font-size: 14px; color: #f5f5f7;">All Departments</label>
                            </div>
                                    <div style="display: flex; align-items: center; background: #3a3a3c; padding: 8px 12px; border-radius: 6px;">
                                        <input type="checkbox" id="eng-dept" style="margin-right: 8px;">
                                        <label for="eng-dept" style="font-size: 14px; color: #f5f5f7;">Engineering</label>
                            </div>
                                    <div style="display: flex; align-items: center; background: #3a3a3c; padding: 8px 12px; border-radius: 6px;">
                                        <input type="checkbox" id="design-dept" style="margin-right: 8px;">
                                        <label for="design-dept" style="font-size: 14px; color: #f5f5f7;">Design</label>
                            </div>
                                    <div style="display: flex; align-items: center; background: #3a3a3c; padding: 8px 12px; border-radius: 6px;">
                                        <input type="checkbox" id="marketing-dept" style="margin-right: 8px;">
                                        <label for="marketing-dept" style="font-size: 14px; color: #f5f5f7;">Marketing</label>
                            </div>
                            </div>
        </div>

                            <div>
                                <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Output Format</label>
                                <div id="formatOptions" style="display: flex; gap: 12px; flex-wrap: wrap;">
                                    <div class="format-option selected" data-format="pdf" style="flex: 1; min-width: 85px; background: #3a3a3c; padding: 12px; border-radius: 8px; cursor: pointer; border: 2px solid #2d7aff; transition: all 0.2s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="PDF" style="width: 20px; height: 20px; filter: invert(1);">
                                            <span style="font-size: 14px; color: #f5f5f7;">PDF</span>
            </div>
                        </div>
                                    <div class="format-option" data-format="xlsx" style="flex: 1; min-width: 85px; background: #3a3a3c; padding: 12px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            <img src="https://cdn-icons-png.flaticon.com/512/888/888850.png" alt="Excel" style="width: 20px; height: 20px; filter: invert(1);">
                                            <span style="font-size: 14px; color: #f5f5f7;">Excel</span>
                    </div>
                </div>
                                    <div class="format-option" data-format="csv" style="flex: 1; min-width: 85px; background: #3a3a3c; padding: 12px; border-radius: 8px; cursor: pointer; border: 2px solid transparent; transition: all 0.2s ease;">
                                        <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                                            <img src="https://cdn-icons-png.flaticon.com/512/6133/6133888.png" alt="CSV" style="width: 20px; height: 20px; filter: invert(1);">
                                            <span style="font-size: 14px; color: #f5f5f7;">CSV</span>
                        </div>
                    </div>
                </div>
                        </div>
                            
                            <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                                <div style="flex: 1; min-width: 200px;">
                                    <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Delivery Method</label>
                                    <select style="width: 100%; padding: 12px; border-radius: 8px; border: none; background: #3a3a3c; color: #f5f5f7;">
                                        <option value="download">Download Now</option>
                                        <option value="email">Email Report</option>
                                        <option value="schedule">Schedule</option>
                                    </select>
                    </div>
                                <div style="flex: 1; min-width: 200px;">
                                    <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Include Visualizations</label>
                                    <select style="width: 100%; padding: 12px; border-radius: 8px; border: none; background: #3a3a3c; color: #f5f5f7;">
                                        <option value="all">All Charts</option>
                                        <option value="summary">Summary Only</option>
                                        <option value="detailed">Detailed Analysis</option>
                                        <option value="none">No Charts</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div style="margin-top: 16px;">
                                <button id="generateReportBtn" style="width: 100%; background: #2d7aff; color: white; border: none; padding: 14px; border-radius: 8px; cursor: pointer; font-weight: 500; font-size: 16px;">Generate Report</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="admin-key-modal" id="adminKeyModal" style="display: none;">
        <div class="modal-content">
            <h3 class="modal-title">Enter Admin Access Key</h3>
            <p class="modal-description">Please enter your admin access key to view this section. This is only available for company accounts with admin privileges.</p>
            <input type="password" class="key-input" placeholder="Enter your admin key">
            <div class="modal-buttons">
                <button class="modal-button cancel-button" onclick="closeAdminKeyModal()">Cancel</button>
                <button class="modal-button confirm-button" onclick="verifyAdminKey()">Verify Key</button>
            </div>
        </div>
    </div>

    <!-- Team Details Modal -->
    <div class="admin-key-modal" id="teamDetailsModal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 class="modal-title" id="teamDetailsTitle">Team Details</h3>
                <button onclick="closeTeamDetailsModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            </div>
            
            <!-- Team Overview Section -->
            <div style="margin-bottom: 24px;">
                <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 20px;">
                    <!-- Team Basic Info -->
                    <div style="flex: 1; min-width: 250px; background: #2c2c2e; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                            <div id="teamIcon" style="width: 48px; height: 48px; background: #2d7aff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white;">üë•</div>
                            <div>
                                <div id="teamName" style="font-size: 18px; font-weight: 600; color: #f5f5f7;">Team Name</div>
                                <div id="teamDepartment" style="font-size: 14px; color: #86868b;">Department</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 16px;">
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Team Members</div>
                                <div id="teamMemberCount" style="font-size: 20px; font-weight: 600; color: #f5f5f7;">0</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Health Score</div>
                                <div id="teamHealthScore" style="font-size: 20px; font-weight: 600; color: #30d158;">0%</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Critical Issues</div>
                                <div id="teamCriticalIssues" style="font-size: 20px; font-weight: 600; color: #ff453a;">0</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Warning Issues</div>
                                <div id="teamWarningIssues" style="font-size: 20px; font-weight: 600; color: #ffd60a;">0</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Team Health Trend -->
                    <div style="flex: 2; min-width: 300px; background: #2c2c2e; border-radius: 12px; padding: 20px;">
                        <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 16px;">Team Health Trend (30 Days)</div>
                        <div style="height: 160px; display: flex; flex-direction: column; justify-content: flex-end; position: relative;">
                            <div class="tooltip" id="barTooltip" style="position: absolute; background: #1c1c1e; color: #f5f5f7; padding: 8px 12px; border-radius: 6px; font-size: 13px; pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 5; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); transform: translateY(-10px);"></div>
                            <div style="display: flex; align-items: flex-end; height: 120px; width: 100%; gap: 8px;">
                                <div class="trend-bar" data-value="65" data-date="Sep 1" style="height: 65%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="68" data-date="Sep 5" style="height: 68%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="70" data-date="Sep 9" style="height: 70%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="72" data-date="Sep 13" style="height: 72%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="74" data-date="Sep 17" style="height: 74%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="71" data-date="Sep 21" style="height: 71%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="69" data-date="Sep 25" style="height: 69%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="73" data-date="Sep 27" style="height: 73%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar" data-value="76" data-date="Sep 29" style="height: 76%; background: #ffd60a; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                                <div class="trend-bar current-bar" data-value="79" data-date="Today" style="height: 79%; background: #30d158; flex: 1; border-radius: 4px 4px 0 0; cursor: pointer; transition: all 0.2s ease;"></div>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; color: #86868b; font-size: 11px;">
                                <span>Sep 1</span>
                                <span>Sep 8</span>
                                <span>Sep 15</span>
                                <span>Sep 22</span>
                                <span>Today</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tabs for Team Details -->
                <div style="background: #2c2c2e; border-radius: 12px; overflow: hidden;">
                    <div style="display: flex; border-bottom: 1px solid #3a3a3c;">
                        <div class="team-detail-tab active" data-tab="members" style="padding: 12px 20px; cursor: pointer; color: #f5f5f7; font-size: 14px; border-bottom: 2px solid #2d7aff;">Team Members</div>
                        <div class="team-detail-tab" data-tab="issues" style="padding: 12px 20px; cursor: pointer; color: #86868b; font-size: 14px; border-bottom: 2px solid transparent;">Current Issues</div>
                        <div class="team-detail-tab" data-tab="resources" style="padding: 12px 20px; cursor: pointer; color: #86868b; font-size: 14px; border-bottom: 2px solid transparent;">Resource Usage</div>
                    </div>
                    
                    <!-- Team Members Tab Content -->
                    <div class="team-detail-content active" id="members-tab" style="padding: 20px;">
                        <div style="background: #3a3a3c; border-radius: 8px; overflow: hidden; max-height: 300px; overflow-y: auto;">
                            <table style="width: 100%; border-collapse: collapse; color: #f5f5f7;">
                                <thead style="position: sticky; top: 0; background: #3a3a3c; z-index: 1;">
                                    <tr style="text-align: left; border-bottom: 1px solid #4c4c4e;">
                                        <th style="padding: 12px;">Member</th>
                                        <th style="padding: 12px;">Role</th>
                                        <th style="padding: 12px;">Health Score</th>
                                        <th style="padding: 12px;">Status</th>
                                        <th style="padding: 12px;">Last Active</th>
                                    </tr>
                                </thead>
                                <tbody id="teamMembersTableBody">
                                    <!-- Team members will be populated here by JavaScript -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <!-- Current Issues Tab Content -->
                    <div class="team-detail-content" id="issues-tab" style="padding: 20px; display: none;">
                        <div id="teamIssuesList" style="display: flex; flex-direction: column; gap: 12px; max-height: 300px; overflow-y: auto; padding-right: 4px;">
                            <!-- Issues will be populated here by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Resource Usage Tab Content -->
                    <div class="team-detail-content" id="resources-tab" style="padding: 20px; display: none;">
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 16px;">
                            <!-- CPU Usage -->
                            <div style="background: #3a3a3c; border-radius: 12px; padding: 16px;">
                                <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 16px;">Average CPU Usage</div>
                                <div style="display: flex; justify-content: center; align-items: center; position: relative; width: 120px; height: 120px; margin: 0 auto 16px;">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#2c2c2e" stroke-width="12" />
                                        <circle id="cpuUsageCircle" cx="60" cy="60" r="54" fill="none" stroke="#30d158" stroke-width="12" stroke-dasharray="339.3" stroke-dashoffset="180" transform="rotate(-90 60 60)" />
                                    </svg>
                                    <div id="cpuUsageText" style="position: absolute; font-size: 24px; font-weight: 700; color: #f5f5f7;">45%</div>
                                </div>
                                <div style="font-size: 13px; color: #86868b; text-align: center;">Average across all team members</div>
                            </div>
                            
                            <!-- Memory Usage -->
                            <div style="background: #3a3a3c; border-radius: 12px; padding: 16px;">
                                <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 16px;">Average Memory Usage</div>
                                <div style="display: flex; justify-content: center; align-items: center; position: relative; width: 120px; height: 120px; margin: 0 auto 16px;">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#2c2c2e" stroke-width="12" />
                                        <circle id="memUsageCircle" cx="60" cy="60" r="54" fill="none" stroke="#ffd60a" stroke-width="12" stroke-dasharray="339.3" stroke-dashoffset="135" transform="rotate(-90 60 60)" />
                                    </svg>
                                    <div id="memUsageText" style="position: absolute; font-size: 24px; font-weight: 700; color: #f5f5f7;">62%</div>
                                </div>
                                <div style="font-size: 13px; color: #86868b; text-align: center;">Average across all team members</div>
                            </div>
                            
                            <!-- Disk Usage -->
                            <div style="background: #3a3a3c; border-radius: 12px; padding: 16px;">
                                <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 16px;">Average Disk Usage</div>
                                <div style="display: flex; justify-content: center; align-items: center; position: relative; width: 120px; height: 120px; margin: 0 auto 16px;">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#2c2c2e" stroke-width="12" />
                                        <circle id="diskUsageCircle" cx="60" cy="60" r="54" fill="none" stroke="#ff9f0a" stroke-width="12" stroke-dasharray="339.3" stroke-dashoffset="101.8" transform="rotate(-90 60 60)" />
                                    </svg>
                                    <div id="diskUsageText" style="position: absolute; font-size: 24px; font-weight: 700; color: #f5f5f7;">70%</div>
                                </div>
                                <div style="font-size: 13px; color: #86868b; text-align: center;">Average across all team members</div>
                            </div>
                            
                            <!-- Network Usage -->
                            <div style="background: #3a3a3c; border-radius: 12px; padding: 16px;">
                                <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 16px;">Network Bandwidth</div>
                                <div style="display: flex; justify-content: center; align-items: center; position: relative; width: 120px; height: 120px; margin: 0 auto 16px;">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="54" fill="none" stroke="#2c2c2e" stroke-width="12" />
                                        <circle id="networkUsageCircle" cx="60" cy="60" r="54" fill="none" stroke="#2d7aff" stroke-width="12" stroke-dasharray="339.3" stroke-dashoffset="203.6" transform="rotate(-90 60 60)" />
                                    </svg>
                                    <div id="networkUsageText" style="position: absolute; font-size: 24px; font-weight: 700; color: #f5f5f7;">40%</div>
                                </div>
                                <div style="font-size: 13px; color: #86868b; text-align: center;">Current network utilization</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Export Team Report</button>
                <button style="background: #2d7aff; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Schedule Maintenance</button>
            </div>
        </div>
    </div>

    <!-- Department Details Modal -->
    <div class="admin-key-modal" id="departmentDetailsModal" style="display: none;">
        <div class="modal-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 class="modal-title" id="departmentDetailsTitle">Department Details</h3>
                <button onclick="closeDepartmentDetailsModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            </div>
            
            <!-- Department Overview Section -->
            <div style="margin-bottom: 24px;">
                <div style="display: flex; flex-wrap: wrap; gap: 16px; margin-bottom: 20px;">
                    <!-- Department Basic Info -->
                    <div style="flex: 1; min-width: 250px; background: #2c2c2e; border-radius: 12px; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 16px;">
                            <div id="departmentIcon" style="width: 48px; height: 48px; background: #2d7aff; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; color: white;">üè¢</div>
                            <div>
                                <div id="departmentName" style="font-size: 18px; font-weight: 600; color: #f5f5f7;">Department Name</div>
                                <div id="departmentMetadata" style="font-size: 14px; color: #86868b;">0 teams ‚Ä¢ 0 devices ‚Ä¢ 0 employees</div>
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr)); gap: 16px;">
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Health Score</div>
                                <div id="departmentHealthScore" style="font-size: 20px; font-weight: 600; color: #30d158;">0%</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Critical Issues</div>
                                <div id="departmentCriticalIssues" style="font-size: 20px; font-weight: 600; color: #ff453a;">0</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Warning Issues</div>
                                <div id="departmentWarningIssues" style="font-size: 20px; font-weight: 600; color: #ffd60a;">0</div>
                            </div>
                            <div>
                                <div style="font-size: 13px; color: #86868b; margin-bottom: 4px;">Uptime</div>
                                <div id="departmentUptime" style="font-size: 20px; font-weight: 600; color: #f5f5f7;">0%</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Department Health Trend -->
                    <div style="flex: 2; min-width: 300px; background: #2c2c2e; border-radius: 12px; padding: 20px;">
                        <div style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin-bottom: 16px;">Department Health Trend (30 Days)</div>
                        <div style="height: 160px; display: flex; flex-direction: column; justify-content: flex-end; position: relative;">
                            <div class="tooltip" id="deptBarTooltip" style="position: absolute; background: #1c1c1e; color: #f5f5f7; padding: 8px 12px; border-radius: 6px; font-size: 13px; pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 5; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3); transform: translateY(-10px);"></div>
                            <div style="display: flex; align-items: flex-end; height: 120px; width: 100%; gap: 8px;" id="departmentTrendBars">
                                <!-- Department trend bars will be populated by JavaScript -->
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-top: 8px; color: #86868b; font-size: 11px;">
                                <span>Sep 1</span>
                                <span>Sep 8</span>
                                <span>Sep 15</span>
                                <span>Sep 22</span>
                                <span>Today</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Teams in Department Section -->
                <div style="background: #2c2c2e; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
                        <h4 style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin: 0;">Teams in Department</h4>
                        <select id="departmentTeamSortFilter" style="background: #3a3a3c; border: none; color: #f5f5f7; padding: 8px 12px; border-radius: 6px; font-size: 13px;">
                            <option value="health-desc">Sort by Health (Highest)</option>
                            <option value="health-asc">Sort by Health (Lowest)</option>
                            <option value="issues-desc">Sort by Issues (Most)</option>
                            <option value="issues-asc">Sort by Issues (Least)</option>
                        </select>
                    </div>
                    <div style="max-height: 300px; overflow-y: auto; margin-top: 16px;">
                        <table style="width: 100%; border-collapse: collapse; color: #f5f5f7;">
                            <thead style="position: sticky; top: 0; background: #2c2c2e; z-index: 1;">
                                <tr style="text-align: left; border-bottom: 1px solid #4c4c4e;">
                                    <th style="padding: 12px;">Team</th>
                                    <th style="padding: 12px;">Members</th>
                                    <th style="padding: 12px;">Devices</th>
                                    <th style="padding: 12px;">Health Score</th>
                                    <th style="padding: 12px;">Issues</th>
                                    <th style="padding: 12px;">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="departmentTeamsTableBody">
                                <!-- Teams will be populated here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Issues Overview Section -->
                <div style="background: #2c2c2e; border-radius: 12px; padding: 20px;">
                    <h4 style="font-size: 16px; font-weight: 500; color: #f5f5f7; margin: 0 0 16px 0;">Critical Issues Summary</h4>
                    <div id="departmentIssuesList" style="display: flex; flex-direction: column; gap: 12px; max-height: 300px; overflow-y: auto; padding-right: 4px;">
                        <!-- Issues will be populated here by JavaScript -->
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
                <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Export Department Report</button>
                <button style="background: #2d7aff; color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 14px;">Schedule Maintenance</button>
            </div>
        </div>
    </div>

    <script>
        // Check if user is admin
        function checkAdminAccess() {
            // In a real app, this would check session/local storage for user role
            // For demo purposes, we'll show the modal
            const isAdmin = localStorage.getItem('isAdmin');
            
            if (!isAdmin) {
                document.getElementById('adminKeyModal').style.display = 'flex';
            }
        }

        function verifyAdminKey() {
            const keyInput = document.querySelector('.key-input').value;
            // In a real app, this would verify the key on the server
            // For demo, we'll accept any non-empty key
            if (keyInput.trim() !== '') {
                localStorage.setItem('isAdmin', 'true');
                closeAdminKeyModal();
            } else {
                alert('Invalid admin key. Please try again.');
            }
        }

        function closeAdminKeyModal() {
            document.getElementById('adminKeyModal').style.display = 'none';
            
            // If not admin, redirect back to dashboard
            if (!localStorage.getItem('isAdmin')) {
                window.location.href = 'itHealthV1.html';
            }
        }

        // Tab navigation functionality
        function initializeTabs() {
            // Set overview tab as active by default
            document.getElementById('overview-tab').classList.add('active');
            
            // No need for tab click handlers since there's only one tab
            // Just make sure the overview tab is always shown
            switchTab('overview');
        }
        
        function switchTab(tabId) {
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show selected tab content
            const tabContent = document.getElementById(tabId + '-tab');
            if (tabContent) {
                tabContent.classList.add('active');
            }
            
            // Update active tab in navigation
            document.querySelectorAll('.admin-tab').forEach(tab => {
                if (tab.getAttribute('data-tab') === tabId) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }
        
        // Mock data functions for real application
        function loadDepartmentStats() {
            // In a real app, this would fetch data from an API
            console.log('Loading department statistics...');
        }
        
        function loadSystemHealth() {
            // In a real app, this would fetch real-time data
            console.log('Loading system health data...');
        }
        
        function loadAISuggestions() {
            // Sample data for devices with issues (in a real app, this would come from an API)
            const deviceIssues = {
                overheating: Math.floor(Math.random() * 8) + 2, // 2-9 devices
                pendingUpdates: Math.floor(Math.random() * 15) + 5, // 5-19 devices
                highResourceUsage: {
                    count: Math.floor(Math.random() * 6) + 3, // 3-8 devices
                    department: ['Design', 'Engineering', 'Marketing'][Math.floor(Math.random() * 3)]
                },
                networkIssues: Math.floor(Math.random() * 7) + 1, // 1-7 devices
                securityRisks: Math.floor(Math.random() * 5) + 1, // 1-5 devices
                backupFailures: Math.floor(Math.random() * 4) + 0 // 0-3 devices
            };

            // Define possible suggestions with their priority levels
            const possibleSuggestions = [
                {
                    id: 'overheating',
                    title: 'Device Overheating Issues',
                    text: `${deviceIssues.overheating} devices are overheating consistently. Recommend applying system cooling patch or changing performance mode to Balanced.`,
                    affected: deviceIssues.overheating,
                    priority: deviceIssues.overheating > 5 ? 'URGENT' : 'HIGH',
                    actionText: 'Apply Recommendation'
                },
                {
                    id: 'updates',
                    title: 'Security Update Deployment',
                    text: `${deviceIssues.pendingUpdates} devices have critical security updates pending for more than 5 days. Schedule deployment during non-working hours.`,
                    affected: deviceIssues.pendingUpdates,
                    priority: deviceIssues.pendingUpdates > 10 ? 'HIGH' : 'MEDIUM',
                    actionText: 'Schedule Updates'
                },
                {
                    id: 'resources',
                    title: 'Performance Optimization',
                    text: `${deviceIssues.highResourceUsage.department} department shows consistently high resource usage during midday. Consider staggering resource-intensive tasks or upgrading RAM on affected machines.`,
                    affected: deviceIssues.highResourceUsage.count,
                    priority: deviceIssues.highResourceUsage.count > 5 ? 'MEDIUM' : 'LOW',
                    actionText: 'Review Details'
                },
                {
                    id: 'network',
                    title: 'Network Connectivity Issues',
                    text: `${deviceIssues.networkIssues} devices experiencing intermittent network dropouts. Router firmware update recommended.`,
                    affected: deviceIssues.networkIssues,
                    priority: deviceIssues.networkIssues > 4 ? 'HIGH' : 'MEDIUM',
                    actionText: 'Deploy Fix'
                },
                {
                    id: 'security',
                    title: 'Security Risk Detected',
                    text: `Unusual login attempts detected on ${deviceIssues.securityRisks} ${deviceIssues.securityRisks === 1 ? 'device' : 'devices'}. Recommend immediate password reset and 2FA enforcement.`,
                    affected: deviceIssues.securityRisks,
                    priority: 'URGENT',
                    actionText: 'Secure Accounts'
                },
                {
                    id: 'backup',
                    title: 'Backup Failure Alert',
                    text: `${deviceIssues.backupFailures} ${deviceIssues.backupFailures === 1 ? 'device has' : 'devices have'} failed their scheduled backups for 3+ days. Data loss risk increasing.`,
                    affected: deviceIssues.backupFailures,
                    priority: deviceIssues.backupFailures > 0 ? 'HIGH' : 'MEDIUM',
                    actionText: 'Restore Backups'
                }
            ];

            // Filter out suggestions with 0 affected devices and sort by priority
            const priorityOrder = { 'URGENT': 0, 'HIGH': 1, 'MEDIUM': 2, 'LOW': 3 };
            const activeSuggestions = possibleSuggestions
                .filter(suggestion => suggestion.affected > 0 || suggestion.id === 'security')
                .sort((a, b) => priorityOrder[a.priority] - priorityOrder[b.priority])
                .slice(0, 3); // Take top 3 highest priority suggestions

            // Get the suggestions container
            const suggestionsContainer = document.querySelector('.suggestions-list');
            suggestionsContainer.innerHTML = '';

            // Add the suggestion count badge to the panel title
            const panelTitle = document.querySelector('.ai-suggestions-panel .panel-title');
            const suggestionCountEl = document.createElement('span');
            suggestionCountEl.className = 'suggestion-count';
            suggestionCountEl.textContent = activeSuggestions.length;

            // Remove any existing badge before adding a new one
            const existingBadge = panelTitle.querySelector('.suggestion-count');
            if (existingBadge) {
                existingBadge.remove();
            }

            // Only show the badge if there are suggestions
            if (activeSuggestions.length > 0) {
                panelTitle.appendChild(suggestionCountEl);
            }

            // Add each suggestion to the container
            activeSuggestions.forEach((suggestion, index) => {
                const suggestionEl = document.createElement('div');
                suggestionEl.className = 'suggestion-item new'; // Add new class for animation
                
                // Add urgent class if priority is URGENT
                if (suggestion.priority === 'URGENT') {
                    suggestionEl.classList.add('urgent');
                }

                // Generate a timestamp between 1 minute and 3 hours ago
                const minutesAgo = Math.floor(Math.random() * 180) + 1;
                let timeAgoText;
                if (minutesAgo < 1) {
                    timeAgoText = 'Just now';
                } else if (minutesAgo === 1) {
                    timeAgoText = '1 minute ago';
                } else if (minutesAgo < 60) {
                    timeAgoText = `${minutesAgo} minutes ago`;
                } else if (minutesAgo < 120) {
                    timeAgoText = '1 hour ago';
                } else {
                    timeAgoText = `${Math.floor(minutesAgo / 60)} hours ago`;
                }

                suggestionEl.innerHTML = `
                    <div class="suggestion-priority">${suggestion.priority}</div>
                    <div class="suggestion-content">
                        <h4 class="suggestion-title">${suggestion.title}</h4>
                        <p class="suggestion-text">${suggestion.text}</p>
                        <div class="affected-users">
                            <span class="affected-label">Affected users:</span>
                            <span class="affected-count">${suggestion.affected}</span>
                            <a href="#" class="view-affected">View list</a>
                        </div>
                        <div class="suggestion-actions">
                            <button class="action-button primary" data-action="${suggestion.id}">${suggestion.actionText}</button>
                            <button class="action-button" data-action="dismiss-${suggestion.id}">Dismiss</button>
                        </div>
                        <span class="suggestion-timestamp">${timeAgoText}</span>
                    </div>
                `;
                
                suggestionsContainer.appendChild(suggestionEl);
                
                // Remove the 'new' class after animation completes
                setTimeout(() => {
                    suggestionEl.classList.remove('new');
                }, 1000);
            });

            // Add action listeners to all suggestion buttons
            document.querySelectorAll('.suggestion-actions .action-button').forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.dataset.action;
                    
                    if (action.startsWith('dismiss-')) {
                        // For dismiss actions, just remove the suggestion
                        const suggestionId = action.replace('dismiss-', '');
                        const suggestionItem = this.closest('.suggestion-item');
                        
                        // Add the dismissing class for animation
                        suggestionItem.classList.add('dismissing');
                        
                        setTimeout(() => {
                            suggestionItem.remove();
                            
                            // If no suggestions left, show a message
                            if (document.querySelectorAll('.suggestion-item').length === 0) {
                                const noSuggestionsEl = document.createElement('div');
                                noSuggestionsEl.className = 'no-suggestions';
                                noSuggestionsEl.textContent = 'No active suggestions at this time. You\'re all caught up!';
                                suggestionsContainer.appendChild(noSuggestionsEl);
                            }
                        }, 300);
                    } else {
                        // For other actions, show a modal or take action
                        alert(`Action requested: ${action}. This would open a detailed view or execute the suggested action.`);
                    }
                });
            });

            console.log('AI suggestions loaded dynamically.');
        }

        // Initialize page
        function initializePage() {
            checkAdminAccess();
            initializeTabs();
            loadDepartmentStats();
            loadSystemHealth();
            loadAISuggestions();
            highlightCurrentPage();
            
            // Add event listener for refresh buttons
            document.querySelectorAll('.refresh-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const panel = this.closest('.system-health-panel, .ai-suggestions-panel');
                    
                    // Don't do anything if already loading
                    if (this.classList.contains('loading')) {
                        return;
                    }
                    
                    // Add loading class
                    this.classList.add('loading');
                    
                    // Save original text
                    const originalText = this.textContent;
                    this.textContent = 'Loading...';
                    
                    // Add loading class to the suggestions list if this is the AI suggestions panel
                    if (panel.classList.contains('ai-suggestions-panel')) {
                        panel.querySelector('.suggestions-list').classList.add('loading');
                    }
                    
                    // Simulate refresh delay
                    setTimeout(() => {
                        if (panel.classList.contains('system-health-panel')) {
                            loadSystemHealth();
                        } else if (panel.classList.contains('ai-suggestions-panel')) {
                            loadAISuggestions();
                            // Remove loading class from suggestions list
                            panel.querySelector('.suggestions-list').classList.remove('loading');
                        }
                        
                        // Restore button text and remove loading class
                        this.textContent = originalText;
                        this.classList.remove('loading');
                    }, 1000);
                });
            });
        }

        // Highlight current page in navigation
        function highlightCurrentPage() {
            const currentPath = window.location.pathname;
            const navLinks = document.querySelectorAll('nav ul li a:not(.logout-btn):not(.restricted-link)');
            
            navLinks.forEach(link => {
                const linkPath = link.getAttribute('href');
                if (currentPath.endsWith(linkPath)) {
                    link.classList.add('active');
                }
            });
            
            // Special case for admin link if on admin page
            if (currentPath.endsWith('company-admin.html')) {
                const adminLink = document.getElementById('adminLink');
                if (adminLink) {
                    adminLink.classList.add('active');
                }
            }
        }

        // Logout function
        function handleLogout() {
            localStorage.clear();
            sessionStorage.clear();
            window.location.href = 'index.html';
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', initializePage);

        // Department filtering functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize department filters
            const departmentFilter = document.getElementById('departmentFilter');
            const metricFilter = document.getElementById('metricFilter');
            const teamDeptFilter = document.getElementById('teamDeptFilter');
            const teamSortFilter = document.getElementById('teamSortFilter');
            
            if (departmentFilter && metricFilter) {
                // Apply filters button
                document.querySelector('.refresh-btn').addEventListener('click', function() {
                    const selectedDept = departmentFilter.value;
                    const selectedMetric = metricFilter.value;
                    
                    console.log(`Filtering data for department: ${selectedDept}, metric: ${selectedMetric}`);
                    // In a real implementation, this would filter the data and update the UI
                    // For demo purposes, we'll just show an alert
                    alert(`Applied filter: ${selectedDept} department, ${selectedMetric} metric`);
                });
            }
            
            if (teamDeptFilter && teamSortFilter) {
                // Team filters
                teamDeptFilter.addEventListener('change', function() {
                    const selectedDept = teamDeptFilter.value;
                    console.log(`Filtering teams for department: ${selectedDept}`);
                    // In a real implementation, this would filter the teams table
                    filterTeamsByDepartment(selectedDept);
                });
                
                teamSortFilter.addEventListener('change', function() {
                    const sortMethod = teamSortFilter.value;
                    console.log(`Sorting teams by: ${sortMethod}`);
                    // In a real implementation, this would sort the teams table
                    sortTeamsByMethod(sortMethod);
                });
            }
        });

        // Function to filter teams by department
        function filterTeamsByDepartment(department) {
            const teamRows = document.querySelectorAll('.team-comparison-table tbody tr');
            
            teamRows.forEach(row => {
                const deptCell = row.querySelector('.team-department');
                if (department === 'all' || deptCell.textContent.toLowerCase() === department) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        // Function to sort teams by different methods
        function sortTeamsByMethod(method) {
            const tbody = document.querySelector('.team-comparison-table tbody');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            // Sort based on the selected method
            rows.sort((a, b) => {
                if (method === 'health-asc') {
                    const scoreA = parseInt(a.cells[3].textContent);
                    const scoreB = parseInt(b.cells[3].textContent);
                    return scoreA - scoreB;
                } else if (method === 'health-desc') {
                    const scoreA = parseInt(a.cells[3].textContent);
                    const scoreB = parseInt(b.cells[3].textContent);
                    return scoreB - scoreA;
                } else if (method === 'issues-desc') {
                    const issuesA = parseInt(a.cells[4].textContent) + parseInt(a.cells[5].textContent);
                    const issuesB = parseInt(b.cells[4].textContent) + parseInt(b.cells[5].textContent);
                    return issuesB - issuesA;
                } else if (method === 'issues-asc') {
                    const issuesA = parseInt(a.cells[4].textContent) + parseInt(a.cells[5].textContent);
                    const issuesB = parseInt(b.cells[4].textContent) + parseInt(b.cells[5].textContent);
                    return issuesA - issuesB;
                }
                return 0;
            });
            
            // Remove all existing rows
            while (tbody.firstChild) {
                tbody.removeChild(tbody.firstChild);
            }
            
            // Add sorted rows back
            rows.forEach(row => tbody.appendChild(row));
        }

        // Function to toggle teams list visibility
        function toggleTeamsList(departmentId) {
            const teamsList = document.getElementById(`${departmentId}-teams`);
            const toggleBtn = document.getElementById(`${departmentId}-teams-toggle`);
            
            if (teamsList.style.display === 'none') {
                teamsList.style.display = 'block';
                toggleBtn.textContent = 'Hide Teams';
            } else {
                teamsList.style.display = 'none';
                toggleBtn.textContent = 'Show Teams';
            }
        }

        // Update view based on filters
        document.addEventListener('DOMContentLoaded', function() {
            const deptStructureFilter = document.getElementById('deptStructureFilter');
            const deptViewType = document.getElementById('deptViewType');
            const refreshDeptView = document.getElementById('refreshDeptView');
            
            if (refreshDeptView) {
                refreshDeptView.addEventListener('click', function() {
                    const selectedDept = deptStructureFilter.value;
                    const viewType = deptViewType.value;
                    
                    console.log(`Updating view: Department=${selectedDept}, ViewType=${viewType}`);
                    
                    // Filter department cards
                    const deptCards = document.querySelectorAll('.dept-structure-card');
                    deptCards.forEach(card => {
                        const deptName = card.querySelector('.dept-name').textContent.toLowerCase();
                        
                        if (selectedDept === 'all' || deptName === selectedDept) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                    
                    // Update view type (in a real implementation)
                    // This would show/hide different metrics based on the selected view
                    if (viewType === 'structure') {
                        // Show organizational structure view
                        alert('Switching to Structure View - would show org chart and reporting lines');
                    } else if (viewType === 'issues') {
                        // Show issues-focused view
                        alert('Switching to Issues View - would prioritize showing issue details');
                    }
                });
            }
        });

        // Report Export Modal functionality
        document.getElementById('exportReportBtn').addEventListener('click', function() {
            document.getElementById('reportExportModal').style.display = 'flex';
        });

        function closeReportModal() {
            document.getElementById('reportExportModal').style.display = 'none';
        }

        // Report template selection functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Set up template selection
            const templateCards = document.querySelectorAll('.report-template-card');
            const reportTypeSelect = document.getElementById('reportTypeSelect');
            const formatOptions = document.querySelectorAll('.format-option');
            
            // Template card selection
            templateCards.forEach(card => {
                // Handle hover effect
                card.addEventListener('mouseenter', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.transform = 'translateY(-5px)';
                        this.style.boxShadow = '0 6px 16px rgba(0, 0, 0, 0.3)';
                    }
                });
                
                card.addEventListener('mouseleave', function() {
                    if (!this.classList.contains('selected')) {
                        this.style.transform = 'translateY(0)';
                        this.style.boxShadow = 'none';
                    }
                });
                
                // Handle click selection
                card.addEventListener('click', function() {
                    const reportType = this.getAttribute('data-report-type');
                    
                    // Update visual selection
                    templateCards.forEach(c => {
                        c.classList.remove('selected');
                        c.style.border = '2px solid transparent';
                        c.style.boxShadow = 'none';
                        c.style.transform = 'translateY(0)';
                        c.querySelector('.selected-indicator').style.display = 'none';
                    });
                    
                    this.classList.add('selected');
                    this.style.border = '2px solid #2d7aff';
                    this.style.boxShadow = '0 0 15px rgba(45, 122, 255, 0.3)';
                    this.querySelector('.selected-indicator').style.display = 'block';
                    
                    // Update select dropdown to match
                    reportTypeSelect.value = reportType;
                    
                    // Show brief animation indicating selection
                    this.animate([
                        { transform: 'scale(1)' },
                        { transform: 'scale(1.04)' },
                        { transform: 'scale(1)' }
                    ], {
                        duration: 300,
                        easing: 'ease-in-out'
                    });
                });
            });
            
            // Link dropdown to template selection
            reportTypeSelect.addEventListener('change', function() {
                const selectedType = this.value;
                
                templateCards.forEach(card => {
                    if (card.getAttribute('data-report-type') === selectedType) {
                        card.click(); // Trigger the click event to update visuals
                    }
                });
            });
            
            // Format selection
            formatOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Update visual selection
                    formatOptions.forEach(o => {
                        o.classList.remove('selected');
                        o.style.border = '2px solid transparent';
                    });
                    
                    this.classList.add('selected');
                    this.style.border = '2px solid #2d7aff';
                });
            });
        });

        // Show generating process when generate button is clicked
        document.getElementById('generateReportBtn').addEventListener('click', function() {
            const selectedFormat = document.querySelector('.format-option.selected').getAttribute('data-format');
            const selectedReportType = document.querySelector('.report-template-card.selected').getAttribute('data-report-type');
            const reportNames = {
                'health': 'System_Health_Report',
                'usage': 'Device_Usage_Report',
                'alerts': 'Alert_History_Report',
                'department': 'Department_Summary_Report',
                'custom': 'Custom_Report'
            };
            
            this.innerText = 'Generating...';
            this.disabled = true;
            
            // Create progress notification
            const progressNotification = document.createElement('div');
            progressNotification.style.position = 'fixed';
            progressNotification.style.bottom = '20px';
            progressNotification.style.right = '20px';
            progressNotification.style.background = '#2c2c2e';
            progressNotification.style.padding = '16px';
            progressNotification.style.borderRadius = '8px';
            progressNotification.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.5)';
            progressNotification.style.color = '#f5f5f7';
            progressNotification.style.zIndex = '9999';
            progressNotification.style.minWidth = '300px';
            
            progressNotification.innerHTML = `
                <div style="display: flex; gap: 12px; align-items: center; margin-bottom: 10px;">
                    <div style="width: 32px; height: 32px;" class="loading-spinner">
                        <div style="border: 3px solid rgba(45, 122, 255, 0.3); border-top: 3px solid #2d7aff; border-radius: 50%; width: 32px; height: 32px; animation: spin 1s linear infinite;"></div>
                    </div>
                    <div>
                        <div style="font-weight: 500; font-size: 14px;">Generating ${reportNames[selectedReportType]}</div>
                        <div style="font-size: 12px; color: #86868b;">Please wait while we process your report...</div>
                    </div>
                </div>
                <div style="height: 6px; width: 100%; background: #3a3a3c; border-radius: 3px; overflow: hidden;">
                    <div class="progress-bar" style="height: 100%; width: 0%; background: #2d7aff; transition: width 2s linear;"></div>
                </div>
            `;
            
            document.body.appendChild(progressNotification);
            
            // Add animation style
            const style = document.createElement('style');
            style.textContent = `
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Animate progress bar
            setTimeout(() => {
                progressNotification.querySelector('.progress-bar').style.width = '100%';
            }, 100);
            
            // Simulate report generation
            setTimeout(() => {
                // Create fake download link based on selected format
                const link = document.createElement('a');
                link.href = '#';
                link.download = `${reportNames[selectedReportType]}.${selectedFormat}`;
                link.click();
                
                // Update notification
                progressNotification.innerHTML = `
                    <div style="display: flex; gap: 12px; align-items: center;">
                        <div style="width: 32px; height: 32px; display: flex; align-items: center; justify-content: center; color: #30d158; font-size: 20px;">‚úì</div>
                        <div>
                            <div style="font-weight: 500; font-size: 14px;">Report Generated Successfully</div>
                            <div style="font-size: 12px; color: #86868b;">${reportNames[selectedReportType]}.${selectedFormat} has been downloaded</div>
                        </div>
                    </div>
                `;
                
                // Remove notification after a delay
                setTimeout(() => {
                    document.body.removeChild(progressNotification);
                }, 3000);
                
                // Reset button
                this.innerText = 'Generate Report';
                this.disabled = false;
                
                // Close modal after a brief delay
                setTimeout(() => {
                    closeReportModal();
                }, 500);
            }, 2000);
        });

        // Handle click outside of modal content to close
        document.getElementById('reportExportModal').addEventListener('click', function(event) {
            if (event.target === this) {
                closeReportModal();
            }
        });

        // Handle tab navigation in team details modal
        document.addEventListener('DOMContentLoaded', function() {
            const teamDetailTabs = document.querySelectorAll('.team-detail-tab');
            
            teamDetailTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs and content
                    teamDetailTabs.forEach(t => {
                        t.classList.remove('active');
                        t.style.color = '#86868b';
                        t.style.borderBottom = '2px solid transparent';
                    });
                    
                    document.querySelectorAll('.team-detail-content').forEach(content => {
                        content.classList.remove('active');
                        content.style.display = 'none';
                    });
                    
                    // Add active class to clicked tab and show content
                    this.classList.add('active');
                    this.style.color = '#f5f5f7';
                    this.style.borderBottom = '2px solid #2d7aff';
                    
                    const tabName = this.getAttribute('data-tab');
                    const content = document.getElementById(`${tabName}-tab`);
                    content.classList.add('active');
                    content.style.display = 'block';
                });
            });
            
            // Set up bar chart hover tooltips
            const trendBars = document.querySelectorAll('.trend-bar');
            const tooltip = document.getElementById('barTooltip');
            
            trendBars.forEach(bar => {
                // Add hover effect
                bar.addEventListener('mouseenter', function(e) {
                    // Update bar style
                    this.style.transform = 'scaleY(1.05)';
                    this.style.boxShadow = '0 0 8px rgba(0, 0, 0, 0.5)';
                    this.style.filter = 'brightness(1.2)';
                    
                    // Get data and position tooltip
                    const value = this.getAttribute('data-value');
                    const date = this.getAttribute('data-date');
                    tooltip.innerHTML = `<strong>${date}:</strong> ${value}%`;
                    
                    // Position tooltip above the bar
                    const barRect = this.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    const containerRect = this.parentNode.parentNode.getBoundingClientRect();
                    
                    // Calculate position (centered above the bar)
                    const leftPos = barRect.left - containerRect.left + (barRect.width / 2) - (tooltipRect.width / 2);
                    // Position tooltip above the chart area entirely, not over the bars
                    const topPos = -tooltipRect.height - 10; // Position above the chart with 10px spacing
                    
                    tooltip.style.left = `${leftPos}px`;
                    tooltip.style.top = `${topPos}px`;
                    tooltip.style.opacity = '1';
                });
                
                bar.addEventListener('mouseleave', function() {
                    // Reset bar style
                    this.style.transform = 'scaleY(1)';
                    this.style.boxShadow = 'none';
                    this.style.filter = 'brightness(1)';
                    
                    // Hide tooltip
                    tooltip.style.opacity = '0';
                });
                
                // Add click effect for potential future functionality
                bar.addEventListener('click', function() {
                    // Animate the bar
                    this.animate([
                        { transform: 'scaleY(1)' },
                        { transform: 'scaleY(0.9)' },
                        { transform: 'scaleY(1)' }
                    ], {
                        duration: 300,
                        easing: 'ease-in-out'
                    });
                    
                    // Get data for potential future functionality
                    const value = this.getAttribute('data-value');
                    const date = this.getAttribute('data-date');
                    console.log(`Clicked on ${date}: ${value}%`);
                    // Could add functionality here to show detailed data for this date
                });
            });
            
            // Handle team details view buttons
            const teamDetailsButtons = document.querySelectorAll('.team-comparison-table .action-button.primary');
            
            teamDetailsButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Get team data from the table row
                    const row = this.closest('tr');
                    const teamName = row.querySelector('.team-name').textContent;
                    const department = row.querySelector('.team-department').textContent;
                    const memberCount = row.children[2].textContent;
                    const healthScore = row.children[3].textContent;
                    const criticalIssues = row.children[4].textContent;
                    const warningIssues = row.children[5].textContent;
                    
                    // Update modal with team data
                    document.getElementById('teamDetailsTitle').textContent = `${teamName} Details`;
                    document.getElementById('teamName').textContent = teamName;
                    document.getElementById('teamDepartment').textContent = department;
                    document.getElementById('teamMemberCount').textContent = memberCount;
                    document.getElementById('teamHealthScore').textContent = healthScore;
                    document.getElementById('teamCriticalIssues').textContent = criticalIssues;
                    document.getElementById('teamWarningIssues').textContent = warningIssues;
                    
                    // Set health score color
                    const healthScoreElement = document.getElementById('teamHealthScore');
                    const healthValue = parseInt(healthScore);
                    if (healthValue < 70) {
                        healthScoreElement.style.color = '#ff453a';
                    } else if (healthValue < 80) {
                        healthScoreElement.style.color = '#ffd60a';
                    } else {
                        healthScoreElement.style.color = '#30d158';
                    }
                    
                    // Generate team members based on memberCount
                    generateTeamMembers(teamName, department, memberCount);
                    
                    // Generate issues based on critical and warning counts
                    generateTeamIssues(criticalIssues, warningIssues);
                    
                    // Update circular progress indicators
                    updateResourceUsage(teamName);
                    
                    // Set icon color based on team name
                    setTeamIconColor(teamName);
                    
                    // Show modal
                    document.getElementById('teamDetailsModal').style.display = 'flex';
                });
            });
        });
        
        function closeTeamDetailsModal() {
            document.getElementById('teamDetailsModal').style.display = 'none';
        }
        
        // Add event listener to close modal when clicking outside
        document.addEventListener('mousedown', function(event) {
            const modal = document.getElementById('teamDetailsModal');
            const modalContent = modal.querySelector('.modal-content');
            
            // If modal is visible and click is outside the modal content
            if (modal.style.display === 'flex' && !modalContent.contains(event.target) && event.target === modal) {
                closeTeamDetailsModal();
            }
        });
        
        function generateTeamMembers(teamName, department, count) {
            const memberRoles = {
                'Backend Team': ['Senior Backend Developer', 'Backend Developer', 'Database Administrator', 'API Developer', 'System Architect'],
                'Frontend Team': ['Senior Frontend Developer', 'Frontend Developer', 'UI Developer', 'React Specialist', 'UX Developer'],
                'DevOps Team': ['DevOps Engineer', 'Cloud Architect', 'System Administrator', 'Release Engineer', 'Automation Specialist'],
                'QA Team': ['QA Lead', 'Test Automation Engineer', 'Manual Tester', 'Performance Tester', 'Security Tester'],
                'UI Design Team': ['UI Designer', 'Visual Designer', 'Interaction Designer', 'UX Researcher', 'Design System Specialist'],
                'UX Research Team': ['UX Researcher', 'User Testing Specialist', 'Accessibility Expert', 'UX Analyst', 'Interaction Designer']
            };
            
            // Add a few more names for demonstration to ensure scrolling
            const names = [
                'Alex Johnson', 'Sarah Miller', 'David Chen', 'Emily Zhang', 'Michael Rodriguez',
                'Jessica Lee', 'James Wilson', 'Lisa Thompson', 'Robert Garcia', 'Jennifer Martinez',
                'Christopher Lee', 'Amanda Clark', 'Daniel Wright', 'Michelle Scott', 'Thomas Walker',
                'Emma Davis', 'Ryan Taylor', 'Olivia Brown', 'Matthew Jones', 'Sophia White',
                'Ethan Harris', 'Ava Martin', 'Benjamin Allen', 'Mia Lewis', 'Noah King'
            ];
            
            const statuses = ['Good', 'Warning', 'Critical'];
            const statusColors = ['#30d158', '#ffd60a', '#ff453a'];
            const tableBody = document.getElementById('teamMembersTableBody');
            tableBody.innerHTML = '';
            
            const roles = memberRoles[teamName] || ['Team Member', 'Senior Member', 'Lead', 'Manager', 'Specialist'];
            
            // Ensure at least 8 team members are shown to demonstrate scrolling
            const minCount = Math.max(8, count);
            
            for (let i = 0; i < minCount; i++) {
                const randomName = names[Math.floor(Math.random() * names.length)];
                const randomRole = roles[Math.floor(Math.random() * roles.length)];
                const statusIndex = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : 2) : 0;
                const status = statuses[statusIndex];
                const healthScore = status === 'Good' ? 
                    (80 + Math.floor(Math.random() * 20)) : 
                    (status === 'Warning' ? (65 + Math.floor(Math.random() * 15)) : (40 + Math.floor(Math.random() * 25)));
                
                const row = document.createElement('tr');
                row.style.borderBottom = i < minCount - 1 ? '1px solid #4c4c4e' : 'none';
                row.innerHTML = `
                    <td style="padding: 12px;">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 32px; height: 32px; background: ${getRandomColor()}; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold;">
                                ${getInitials(randomName)}
                            </div>
                            <div>${randomName}</div>
                        </div>
                    </td>
                    <td style="padding: 12px;">${randomRole}</td>
                    <td style="padding: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 60px; background: #2c2c2e; height: 4px; border-radius: 2px; position: relative;">
                                <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${healthScore}%; background: ${statusColors[statusIndex]}; border-radius: 2px;"></div>
                            </div>
                            <span>${healthScore}%</span>
                        </div>
                    </td>
                    <td style="padding: 12px; color: ${statusColors[statusIndex]};">${status}</td>
                    <td style="padding: 12px;">${Math.floor(Math.random() * 60) + 1}m ago</td>
                `;
                tableBody.appendChild(row);
            }
        }
        
        function generateTeamIssues(criticalCount, warningCount) {
            const issuesList = document.getElementById('teamIssuesList');
            issuesList.innerHTML = '';
            
            const criticalIssues = [
                'High Memory Usage: 94% of available RAM used',
                'CPU Throttling: Process is causing CPU to throttle',
                'Disk Space Critical: Less than 5% available',
                'System Crash: Abnormal shutdown detected',
                'Security Vulnerability: Critical update required',
                'Database Connection Failure: Unable to connect to primary database',
                'Network Interface Down: Connection lost on eth0',
                'Process Deadlock: Multiple processes in deadlock state'
            ];
            
            const warningIssues = [
                'Memory Usage High: 83% of available RAM used',
                'Disk Space Low: 12% available space remaining',
                'Updates Pending: 3 security updates pending',
                'Temporary Files Accumulation: 4.2GB of temp files',
                'High CPU Spikes During: Usage peaks at specific times',
                'Network Latency Issues: High latency detected',
                'GPU Driver Outdated: Performance impact likely',
                'SSL Certificate Expiring: 15 days remaining',
                'Backup Process Slow: Taking longer than usual',
                'Non-optimized Queries: Database query performance degraded'
            ];
            
            // Always show at least 3 critical and 5 warning issues for demonstration
            const minCriticalCount = Math.max(parseInt(criticalCount) || 0, 3);
            const minWarningCount = Math.max(parseInt(warningCount) || 0, 5);
            
            // Add critical issues
            for (let i = 0; i < minCriticalCount; i++) {
                if (i < criticalIssues.length) {
                    const issue = document.createElement('div');
                    issue.style.background = 'rgba(255, 69, 58, 0.1)';
                    issue.style.borderLeft = '3px solid #ff453a';
                    issue.style.borderRadius = '8px';
                    issue.style.padding = '16px';
                    
                    issue.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="font-size: 14px; font-weight: 500; color: #ff453a;">Critical Issue</div>
                            <div style="font-size: 12px; color: #86868b;">Detected ${Math.floor(Math.random() * 12) + 1}h ago</div>
                        </div>
                        <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 4px;">${criticalIssues[i]}</div>
                        <div style="font-size: 13px; color: #86868b; margin-bottom: 12px;">Affecting ${Math.floor(Math.random() * 3) + 1} team members</div>
                        <div style="display: flex; gap: 8px;">
                            <button style="background: #ff453a; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Fix Now</button>
                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Notify Team</button>
                        </div>
                    `;
                    issuesList.appendChild(issue);
                }
            }
            
            // Add warning issues
            for (let i = 0; i < minWarningCount; i++) {
                if (i < warningIssues.length) {
                    const issue = document.createElement('div');
                    issue.style.background = 'rgba(255, 214, 10, 0.1)';
                    issue.style.borderLeft = '3px solid #ffd60a';
                    issue.style.borderRadius = '8px';
                    issue.style.padding = '16px';
                    
                    issue.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                            <div style="font-size: 14px; font-weight: 500; color: #ffd60a;">Warning Issue</div>
                            <div style="font-size: 12px; color: #86868b;">Detected ${Math.floor(Math.random() * 12) + 1}h ago</div>
                        </div>
                        <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 4px;">${warningIssues[i]}</div>
                        <div style="font-size: 13px; color: #86868b; margin-bottom: 12px;">Affecting ${Math.floor(Math.random() * 3) + 1} team members</div>
                        <div style="display: flex; gap: 8px;">
                            <button style="background: #ffd60a; color: #1d1d1f; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Schedule Fix</button>
                            <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Notify Team</button>
                        </div>
                    `;
                    issuesList.appendChild(issue);
                }
            }
        }
        
        function updateResourceUsage(teamName) {
            // Generate random but sensible values based on team name
            let cpuUsage, memUsage, diskUsage, networkUsage;
            
            if (teamName === 'Backend Team') {
                cpuUsage = 55 + Math.floor(Math.random() * 15);
                memUsage = 65 + Math.floor(Math.random() * 12);
                diskUsage = 60 + Math.floor(Math.random() * 15);
                networkUsage = 45 + Math.floor(Math.random() * 15);
            } else if (teamName === 'Frontend Team') {
                cpuUsage = 40 + Math.floor(Math.random() * 15);
                memUsage = 60 + Math.floor(Math.random() * 10);
                diskUsage = 50 + Math.floor(Math.random() * 15);
                networkUsage = 35 + Math.floor(Math.random() * 15);
            } else if (teamName === 'DevOps Team') {
                cpuUsage = 30 + Math.floor(Math.random() * 15);
                memUsage = 45 + Math.floor(Math.random() * 15);
                diskUsage = 60 + Math.floor(Math.random() * 15);
                networkUsage = 50 + Math.floor(Math.random() * 15);
            } else if (teamName === 'QA Team') {
                cpuUsage = 35 + Math.floor(Math.random() * 15);
                memUsage = 50 + Math.floor(Math.random() * 15);
                diskUsage = 55 + Math.floor(Math.random() * 10);
                networkUsage = 40 + Math.floor(Math.random() * 10);
            } else if (teamName.includes('Design')) {
                cpuUsage = 45 + Math.floor(Math.random() * 20);
                memUsage = 70 + Math.floor(Math.random() * 15);
                diskUsage = 75 + Math.floor(Math.random() * 10);
                networkUsage = 30 + Math.floor(Math.random() * 15);
            } else {
                cpuUsage = 40 + Math.floor(Math.random() * 20);
                memUsage = 55 + Math.floor(Math.random() * 20);
                diskUsage = 65 + Math.floor(Math.random() * 15);
                networkUsage = 35 + Math.floor(Math.random() * 15);
            }
            
            // Update circle values
            const cpuCircle = document.getElementById('cpuUsageCircle');
            const memCircle = document.getElementById('memUsageCircle');
            const diskCircle = document.getElementById('diskUsageCircle');
            const networkCircle = document.getElementById('networkUsageCircle');
            
            const circumference = 2 * Math.PI * 54;
            
            cpuCircle.style.strokeDashoffset = circumference * (1 - cpuUsage / 100);
            memCircle.style.strokeDashoffset = circumference * (1 - memUsage / 100);
            diskCircle.style.strokeDashoffset = circumference * (1 - diskUsage / 100);
            networkCircle.style.strokeDashoffset = circumference * (1 - networkUsage / 100);
            
            // Update text values
            document.getElementById('cpuUsageText').textContent = `${cpuUsage}%`;
            document.getElementById('memUsageText').textContent = `${memUsage}%`;
            document.getElementById('diskUsageText').textContent = `${diskUsage}%`;
            document.getElementById('networkUsageText').textContent = `${networkUsage}%`;
            
            // Update circle colors based on values
            cpuCircle.style.stroke = cpuUsage > 70 ? '#ff453a' : cpuUsage > 50 ? '#ffd60a' : '#30d158';
            memCircle.style.stroke = memUsage > 75 ? '#ff453a' : memUsage > 60 ? '#ffd60a' : '#30d158';
            diskCircle.style.stroke = diskUsage > 80 ? '#ff453a' : diskUsage > 65 ? '#ffd60a' : '#30d158';
            networkCircle.style.stroke = networkUsage > 75 ? '#ff453a' : networkUsage > 60 ? '#ffd60a' : '#2d7aff';
        }
        
        function setTeamIconColor(teamName) {
            const icon = document.getElementById('teamIcon');
            let color = '#2d7aff';
            let emoji = 'üë•';
            
            if (teamName.includes('Backend')) {
                color = '#ff9f0a';
                emoji = '‚öôÔ∏è';
            } else if (teamName.includes('Frontend')) {
                color = '#32d74b';
                emoji = 'üñ•Ô∏è';
            } else if (teamName.includes('DevOps')) {
                color = '#5e5ce6';
                emoji = 'üöÄ';
            } else if (teamName.includes('QA')) {
                color = '#bf5af2';
                emoji = 'üîç';
            } else if (teamName.includes('Design')) {
                color = '#ff375f';
                emoji = 'üé®';
            } else if (teamName.includes('Research')) {
                color = '#64d2ff';
                emoji = 'üìä';
            }
            
            icon.style.background = color;
            icon.textContent = emoji;
        }
        
        function getRandomColor() {
            const colors = [
                '#2d7aff', '#ff9f0a', '#32d74b', '#5e5ce6', 
                '#bf5af2', '#ff375f', '#64d2ff', '#ff453a'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
        
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('');
        }

        // Report Export Modal functionality
        document.getElementById('exportReportBtn').addEventListener('click', function() {
            document.getElementById('reportExportModal').style.display = 'flex';
        });

        // Open team details modal with data
        function openTeamDetailsModal(team) {
            // Populate team details...
            document.getElementById('teamName').textContent = team.innerText;
            document.getElementById('teamDepartment').textContent = team.parentNode.parentNode.querySelector('td:first-child').innerText;
            
            // Show modal
            document.getElementById('teamDetailsModal').style.display = 'flex';
            
            // Generate mock data
            const healthScore = parseInt(team.parentNode.parentNode.querySelector('td:nth-child(3) .health-score').textContent);
            const criticalIssues = parseInt(team.parentNode.parentNode.querySelector('td:nth-child(4)').textContent);
            const warningIssues = parseInt(team.parentNode.parentNode.querySelector('td:nth-child(5)').textContent);
            const teamSize = Math.floor(Math.random() * 8) + 3; // 3 to 10 team members
            
            document.getElementById('teamSizeValue').textContent = teamSize;
            document.getElementById('teamHealthValue').textContent = healthScore + '%';
            document.getElementById('criticalIssuesValue').textContent = criticalIssues;
            document.getElementById('warningIssuesValue').textContent = warningIssues;
            
            // Populate tabs
            document.getElementById('membersTabBtn').click(); // Activate members tab by default
            generateTeamMembers(team.innerText, document.getElementById('teamDepartment').textContent, teamSize);
            generateTeamIssues(criticalIssues, warningIssues);
            generateResourceUsage();
            
            // Generate health trend data
            generateHealthTrend();
        }
        
        function closeTeamDetailsModal() {
            document.getElementById('teamDetailsModal').style.display = 'none';
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(event) {
            const modal = document.getElementById('teamDetailsModal');
            if (event.target === modal) {
                closeTeamDetailsModal();
            }
        });

        // Add the department details modal functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Add click event listeners to "View Department Details" buttons
            const departmentDetailButtons = document.querySelectorAll('.dept-actions .action-button.primary');
            
            departmentDetailButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Get the department card containing this button
                    const departmentCard = this.closest('.dept-structure-card');
                    
                    if (departmentCard) {
                        // Extract department data
                        const departmentName = departmentCard.querySelector('.dept-name').textContent;
                        const departmentStats = departmentCard.querySelector('.dept-count').textContent;
                        const healthScore = departmentCard.querySelector('.metric-value').textContent.split('%')[0].trim();
                        
                        // Get issue counts
                        const criticalIssuesText = departmentCard.querySelector('.metric-tag.critical').textContent;
                        const warningIssuesText = departmentCard.querySelector('.metric-tag.warning').textContent;
                        
                        const criticalIssues = parseInt(criticalIssuesText.split(' ')[0]);
                        const warningIssues = parseInt(warningIssuesText.split(' ')[0]);
                        
                        // Open the department details modal with this data
                        openDepartmentDetailsModal(departmentName, departmentStats, healthScore, criticalIssues, warningIssues);
                    }
                });
            });
        });
        
        // Function to open department details modal
        function openDepartmentDetailsModal(departmentName, departmentStats, healthScore, criticalIssues, warningIssues) {
            // Set the modal title
            document.getElementById('departmentDetailsTitle').textContent = `${departmentName} Department Details`;
            
            // Set department basic info
            document.getElementById('departmentName').textContent = departmentName;
            document.getElementById('departmentMetadata').textContent = departmentStats;
            
            // Set metrics
            document.getElementById('departmentHealthScore').textContent = `${healthScore}%`;
            document.getElementById('departmentCriticalIssues').textContent = criticalIssues;
            document.getElementById('departmentWarningIssues').textContent = warningIssues;
            document.getElementById('departmentUptime').textContent = '99.7%';
            
            // Style health score based on value
            const healthScoreElement = document.getElementById('departmentHealthScore');
            if (parseInt(healthScore) < 70) {
                healthScoreElement.style.color = '#ff453a'; // Red for poor health
            } else if (parseInt(healthScore) < 80) {
                healthScoreElement.style.color = '#ffd60a'; // Yellow for warning
            } else {
                healthScoreElement.style.color = '#30d158'; // Green for good health
            }
            
            // Generate health trend data
            generateDepartmentHealthTrend(departmentName, parseInt(healthScore));
            
            // Generate teams table for this department
            generateDepartmentTeamsTable(departmentName);
            
            // Generate issues list for this department
            generateDepartmentIssuesList(criticalIssues, warningIssues);
            
            // Show the modal
            document.getElementById('departmentDetailsModal').style.display = 'flex';
        }
        
        // Function to close department details modal
        function closeDepartmentDetailsModal() {
            document.getElementById('departmentDetailsModal').style.display = 'none';
        }
        
        // Add event listener to close modal when clicking outside
        document.addEventListener('mousedown', function(event) {
            const modal = document.getElementById('departmentDetailsModal');
            const modalContent = modal?.querySelector('.modal-content');
            
            if (modal && modalContent) {
                // If modal is visible and click is outside the modal content
                if (modal.style.display === 'flex' && !modalContent.contains(event.target) && event.target === modal) {
                    closeDepartmentDetailsModal();
                }
            }
        });
        
        // Generate department health trend
        function generateDepartmentHealthTrend(departmentName, currentHealth) {
            const trendBarsContainer = document.getElementById('departmentTrendBars');
            trendBarsContainer.innerHTML = '';
            
            // Generate some random but somewhat realistic health trend data
            // The current health score will be the last value
            let baseHealth;
            if (departmentName === 'Engineering') {
                baseHealth = 72;
            } else if (departmentName === 'Design') {
                baseHealth = 80;
            } else if (departmentName === 'Marketing') {
                baseHealth = 87;
            } else if (departmentName === 'Sales') {
                baseHealth = 84;
            } else if (departmentName === 'Support') {
                baseHealth = 65;
            } else {
                baseHealth = 75;
            }
            
            const dates = ['Sep 1', 'Sep 5', 'Sep 9', 'Sep 13', 'Sep 17', 'Sep 21', 'Sep 25', 'Sep 27', 'Sep 29', 'Today'];
            const healthValues = [];
            
            // Generate some variation, trending toward the current health
            for (let i = 0; i < 9; i++) {
                // More variation at the beginning, less at the end as we get closer to current value
                const variation = Math.round(Math.random() * 8) - 4; // -4 to +4
                const weightedVariation = variation * (1 - (i / 9) * 0.7); // Reduce variation as we get closer to current
                
                // Start from baseHealth and gradually move toward currentHealth
                const targetHealth = baseHealth + (currentHealth - baseHealth) * (i / 9);
                
                healthValues.push(Math.round(targetHealth + weightedVariation));
            }
            // Add current health as the last value
            healthValues.push(currentHealth);
            
            // Create bars
            for (let i = 0; i < 10; i++) {
                const healthValue = healthValues[i];
                const date = dates[i];
                
                // Determine color based on health score
                let barColor;
                if (healthValue < 70) {
                    barColor = '#ff453a'; // Red for poor health
                } else if (healthValue < 80) {
                    barColor = '#ffd60a'; // Yellow for warning
                } else {
                    barColor = '#30d158'; // Green for good health
                }
                
                // Add a highlighted class for today's bar
                const isCurrentBar = i === 9;
                
                const bar = document.createElement('div');
                bar.className = isCurrentBar ? 'trend-bar current-bar' : 'trend-bar';
                bar.style.height = `${healthValue}%`;
                bar.style.background = barColor;
                bar.style.flex = '1';
                bar.style.borderRadius = '4px 4px 0 0';
                bar.style.cursor = 'pointer';
                bar.style.transition = 'all 0.2s ease';
                bar.setAttribute('data-value', healthValue);
                bar.setAttribute('data-date', date);
                
                // Add tooltip functionality
                bar.addEventListener('mouseenter', function(e) {
                    // Update bar style
                    this.style.transform = 'scaleY(1.05)';
                    this.style.boxShadow = '0 0 8px rgba(0, 0, 0, 0.5)';
                    this.style.filter = 'brightness(1.2)';
                    
                    // Get data and position tooltip
                    const value = this.getAttribute('data-value');
                    const date = this.getAttribute('data-date');
                    const tooltip = document.getElementById('deptBarTooltip');
                    tooltip.innerHTML = `<strong>${date}:</strong> ${value}%`;
                    
                    // Position tooltip above the bar
                    const barRect = this.getBoundingClientRect();
                    const tooltipRect = tooltip.getBoundingClientRect();
                    const containerRect = this.parentNode.parentNode.getBoundingClientRect();
                    
                    // Calculate position (centered above the bar)
                    const leftPos = barRect.left - containerRect.left + (barRect.width / 2) - (tooltipRect.width / 2);
                    // Position tooltip above the chart area entirely, not over the bars
                    const topPos = -tooltipRect.height - 10; // Position above the chart with 10px spacing
                    
                    tooltip.style.left = `${leftPos}px`;
                    tooltip.style.top = `${topPos}px`;
                    tooltip.style.opacity = '1';
                });
                
                bar.addEventListener('mouseleave', function() {
                    // Reset bar style
                    this.style.transform = 'scaleY(1)';
                    this.style.boxShadow = 'none';
                    this.style.filter = 'brightness(1)';
                    
                    // Hide tooltip
                    document.getElementById('deptBarTooltip').style.opacity = '0';
                });
                
                trendBarsContainer.appendChild(bar);
            }
        }
        
        // Generate teams table for department
        function generateDepartmentTeamsTable(departmentName) {
            const tableBody = document.getElementById('departmentTeamsTableBody');
            tableBody.innerHTML = '';
            
            let teamData = [];
            
            // Generate team data based on department
            if (departmentName === 'Engineering') {
                teamData = [
                    { name: 'Backend Team', members: 8, devices: 10, health: 65, critical: 4, warning: 7 },
                    { name: 'Frontend Team', members: 6, devices: 7, health: 79, critical: 1, warning: 3 },
                    { name: 'DevOps Team', members: 5, devices: 7, health: 82, critical: 0, warning: 2 }
                ];
            } else if (departmentName === 'Design') {
                teamData = [
                    { name: 'UI Design Team', members: 7, devices: 7, health: 84, critical: 1, warning: 3 },
                    { name: 'UX Research Team', members: 5, devices: 5, health: 79, critical: 1, warning: 2 }
                ];
            } else if (departmentName === 'Marketing') {
                teamData = [
                    { name: 'Digital Marketing', members: 6, devices: 6, health: 93, critical: 0, warning: 1 },
                    { name: 'Content Creation', members: 4, devices: 4, health: 88, critical: 0, warning: 2 }
                ];
            } else if (departmentName === 'Sales') {
                teamData = [
                    { name: 'Inside Sales', members: 5, devices: 5, health: 85, critical: 1, warning: 2 },
                    { name: 'Field Sales', members: 7, devices: 7, health: 88, critical: 0, warning: 1 }
                ];
            } else if (departmentName === 'Support') {
                teamData = [
                    { name: 'Customer Support', members: 6, devices: 6, health: 72, critical: 2, warning: 4 },
                    { name: 'Technical Support', members: 4, devices: 4, health: 65, critical: 2, warning: 3 }
                ];
            } else {
                // Generic fallback data
                teamData = [
                    { name: 'Team 1', members: 5, devices: 5, health: 80, critical: 1, warning: 2 },
                    { name: 'Team 2', members: 7, devices: 7, health: 75, critical: 2, warning: 3 }
                ];
            }
            
            // Populate table with team data
            teamData.forEach(team => {
                const row = document.createElement('tr');
                row.style.borderBottom = '1px solid #4c4c4e';
                
                // Determine health status color
                let healthColor;
                if (team.health < 70) {
                    healthColor = '#ff453a'; // Red for poor health
                } else if (team.health < 80) {
                    healthColor = '#ffd60a'; // Yellow for warning
                } else {
                    healthColor = '#30d158'; // Green for good health
                }
                
                row.innerHTML = `
                    <td style="padding: 12px;">
                        <div style="font-weight: 500;">${team.name}</div>
                    </td>
                    <td style="padding: 12px;">${team.members}</td>
                    <td style="padding: 12px;">${team.devices}</td>
                    <td style="padding: 12px;">
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <div style="width: 60px; background: #2c2c2e; height: 4px; border-radius: 2px; position: relative;">
                                <div style="position: absolute; top: 0; left: 0; height: 100%; width: ${team.health}%; background: ${healthColor}; border-radius: 2px;"></div>
                            </div>
                            <span style="color: ${healthColor};">${team.health}%</span>
                        </div>
                    </td>
                    <td style="padding: 12px;">
                        <span style="color: #ff453a; margin-right: 8px;">${team.critical} critical</span>
                        <span style="color: #ffd60a;">${team.warning} warning</span>
                    </td>
                    <td style="padding: 12px;">
                        <button class="action-button small">View Team</button>
                    </td>
                `;
                
                tableBody.appendChild(row);
            });
            
            // Add event listeners to "View Team" buttons
            const viewTeamButtons = tableBody.querySelectorAll('.action-button.small');
            viewTeamButtons.forEach((button, index) => {
                button.addEventListener('click', function() {
                    // Close department details modal
                    closeDepartmentDetailsModal();
                    
                    // Create a mock team element for the openTeamDetailsModal function
                    const team = {
                        innerText: teamData[index].name,
                        parentNode: {
                            parentNode: {
                                querySelector: (selector) => {
                                    if (selector === 'td:first-child') {
                                        return { innerText: departmentName };
                                    } else if (selector === 'td:nth-child(3) .health-score') {
                                        return { textContent: teamData[index].health };
                                    } else if (selector === 'td:nth-child(4)') {
                                        return { textContent: teamData[index].critical };
                                    } else if (selector === 'td:nth-child(5)') {
                                        return { textContent: teamData[index].warning };
                                    }
                                }
                            }
                        }
                    };
                    
                    // Open team details modal
                    openTeamDetailsModal(team);
                });
            });
        }
        
        // Generate issues list for department
        function generateDepartmentIssuesList(criticalCount, warningCount) {
            const issuesList = document.getElementById('departmentIssuesList');
            issuesList.innerHTML = '';
            
            const criticalIssues = [
                'High Memory Usage: 94% of available RAM used across multiple devices',
                'CPU Throttling: Processes causing CPU to throttle on developer workstations',
                'Disk Space Critical: Less than 5% available on shared storage',
                'System Crash: Abnormal shutdowns detected on multiple systems',
                'Security Vulnerability: Critical updates required for department systems',
                'Database Connection Failure: Unable to connect to department database',
                'Network Interface Down: Connection lost on primary network',
                'Process Deadlock: Multiple processes in deadlock state'
            ];
            
            // Show critical issues
            const showCount = Math.min(criticalCount, criticalIssues.length);
            for (let i = 0; i < showCount; i++) {
                const issue = document.createElement('div');
                issue.style.background = 'rgba(255, 69, 58, 0.1)';
                issue.style.borderLeft = '3px solid #ff453a';
                issue.style.borderRadius = '8px';
                issue.style.padding = '16px';
                
                issue.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="font-size: 14px; font-weight: 500; color: #ff453a;">Critical Issue</div>
                        <div style="font-size: 12px; color: #86868b;">Detected ${Math.floor(Math.random() * 12) + 1}h ago</div>
                    </div>
                    <div style="font-size: 14px; color: #f5f5f7; margin-bottom: 4px;">${criticalIssues[i]}</div>
                    <div style="font-size: 13px; color: #86868b; margin-bottom: 12px;">Affecting ${Math.floor(Math.random() * 3) + 1} teams</div>
                    <div style="display: flex; gap: 8px;">
                        <button style="background: #ff453a; color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Fix Now</button>
                        <button style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">Notify Teams</button>
                    </div>
                `;
                issuesList.appendChild(issue);
            }
            
            // If no issues
            if (showCount === 0) {
                const noIssues = document.createElement('div');
                noIssues.style.textAlign = 'center';
                noIssues.style.padding = '40px 0';
                noIssues.innerHTML = `
                    <div style="font-size: 48px; margin-bottom: 16px;">‚úÖ</div>
                    <div style="font-size: 18px; font-weight: 500; color: #30d158; margin-bottom: 8px;">No Critical Issues</div>
                    <div style="font-size: 14px; color: #86868b;">This department currently has no critical issues</div>
                `;
                issuesList.appendChild(noIssues);
            }
        }

        // Function to show the action modal for fixing issues
        function showFixModal(issueDescription) {
            // Set modal title and initial message
            document.getElementById('actionModalTitle').textContent = 'Automated Fix Process';
            document.getElementById('actionModalMessage').textContent = `Fixing: ${issueDescription}`;
            
            // Create steps for the process
            const stepsContainer = document.getElementById('actionModalSteps');
            stepsContainer.innerHTML = '';
            
            const steps = [
                'Analyzing issue...',
                'Identifying root cause...',
                'Preparing fixes...',
                'Applying system patches...',
                'Verifying fix...'
            ];
            
            const stepsList = document.createElement('ul');
            stepsList.style.listStyleType = 'none';
            stepsList.style.padding = '0';
            stepsList.style.margin = '0';
            
            steps.forEach(step => {
                const stepItem = document.createElement('li');
                stepItem.style.padding = '10px 0';
                stepItem.style.borderBottom = '1px solid #3a3a3c';
                stepItem.style.display = 'flex';
                stepItem.style.alignItems = 'center';
                stepItem.style.gap = '10px';
                stepItem.style.color = '#86868b';
                
                const statusIcon = document.createElement('span');
                statusIcon.style.width = '18px';
                statusIcon.style.height = '18px';
                statusIcon.style.borderRadius = '50%';
                statusIcon.style.background = '#3a3a3c';
                statusIcon.style.display = 'inline-flex';
                statusIcon.style.alignItems = 'center';
                statusIcon.style.justifyContent = 'center';
                statusIcon.style.fontSize = '12px';
                statusIcon.textContent = '‚ãØ';
                
                stepItem.appendChild(statusIcon);
                stepItem.appendChild(document.createTextNode(step));
                stepsList.appendChild(stepItem);
            });
            
            stepsContainer.appendChild(stepsList);
            
            // Reset progress bar
            const progressBar = document.getElementById('actionModalProgressBar');
            progressBar.style.width = '0%';
            
            // Hide close button initially
            document.getElementById('actionModalCloseBtn').style.display = 'none';
            
            // Show modal
            document.getElementById('actionModal').style.display = 'flex';
            
            // Start the progress simulation
            simulateFixProgress(stepsList.querySelectorAll('li'), progressBar);
        }
        
        // Function to simulate fix progress
        function simulateFixProgress(stepItems, progressBar) {
            let currentStep = 0;
            const totalSteps = stepItems.length;
            
            function updateProgress() {
                if (currentStep < totalSteps) {
                    // Update progress bar
                    progressBar.style.width = `${(currentStep + 1) * (100 / totalSteps)}%`;
                    
                    // Update current step status
                    const stepItem = stepItems[currentStep];
                    const statusIcon = stepItem.querySelector('span');
                    
                    stepItem.style.color = '#f5f5f7';
                    statusIcon.style.background = '#2d7aff';
                    statusIcon.textContent = '‚ãØ';
                    statusIcon.style.animation = 'spin 1s linear infinite';
                    
                    // After a delay, mark this step as complete and move to the next
                    setTimeout(() => {
                        statusIcon.style.animation = 'none';
                        statusIcon.style.background = '#30d158';
                        statusIcon.textContent = '‚úì';
                        
                        currentStep++;
                        
                        if (currentStep < totalSteps) {
                            // Move to next step after a short delay
                            setTimeout(updateProgress, 800);
                        } else {
                            // All steps complete
                            finishFixProcess();
                        }
                    }, 1500);
                }
            }
            
            // Add a simple spin animation
            const style = document.createElement('style');
            style.textContent = '@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }';
            document.head.appendChild(style);
            
            // Start the progress update
            updateProgress();
        }
        
        // Function to finish the fix process
        function finishFixProcess() {
            // Update progress bar to 100%
            const progressBar = document.getElementById('actionModalProgressBar');
            progressBar.style.width = '100%';
            progressBar.style.background = '#30d158';
            
            // Update message
            document.getElementById('actionModalMessage').textContent = 'Fix successfully applied!';
            
            // Show close button
            const closeBtn = document.getElementById('actionModalCloseBtn');
            closeBtn.style.display = 'inline-block';
            closeBtn.textContent = 'Close';
            closeBtn.onclick = closeActionModal;
        }
        
        // Function to close the action modal
        function closeActionModal() {
            document.getElementById('actionModal').style.display = 'none';
        }
        
        // Add event listener to close modal when clicking outside
        document.addEventListener('mousedown', function(event) {
            const modal = document.getElementById('actionModal');
            const modalContent = modal?.querySelector('.modal-content');
            
            if (modal && modalContent) {
                // If modal is visible and click is outside the modal content
                if (modal.style.display === 'flex' && !modalContent.contains(event.target) && event.target === modal) {
                    closeActionModal();
                }
            }
        });

        // Fix Now and Notify Team functionality
        function setupActionButtons() {
            // Remove previous listeners to avoid duplicates
            document.removeEventListener('click', handleActionButtonClick);
            
            // Add a global click handler using event delegation
            document.addEventListener('click', handleActionButtonClick);
        }

        // Global handler for all action button clicks using event delegation
        function handleActionButtonClick(event) {
            // Find if the click was on a button or inside one
            const target = event.target;
            const button = target.tagName === 'BUTTON' ? target : target.closest('button');
            
            if (!button) return; // Not a button click
            
            const buttonText = button.textContent.trim();
            
            // Handle Fix Now buttons
            if (buttonText === 'Fix Now' || button.classList.contains('fix-now')) {
                event.preventDefault();
                handleFixNowClick(button);
            }
            // Handle Notify Team/Teams buttons (handle different text variations)
            else if (buttonText === 'Notify Team' || buttonText === 'Notify Teams' || 
                     button.classList.contains('notify-team') || button.classList.contains('notify-teams')) {
                event.preventDefault();
                handleNotifyTeamClick(button);
            }
        }

        function handleFixNowClick(button) {
            // Find the issue container - handle different possible parent structures
            const issueContainer = button.closest('.notification-item, .issue-item, .critical-issue') || 
                                   button.closest('[class*="issue"]') || 
                                   button.closest('section');
            
            let issueTitle = 'System Issue';
            let issueDetails = 'A system issue has been detected that requires attention.';
            
            // Try to extract more specific issue details
            if (issueContainer) {
                // Try different selectors for title elements
                const titleCandidates = [
                    issueContainer.querySelector('.notification-title'),
                    issueContainer.querySelector('.issue-title'),
                    issueContainer.querySelector('h2'),
                    issueContainer.querySelector('h3'),
                    issueContainer.querySelector('strong')
                ];
                
                for (const titleEl of titleCandidates) {
                    if (titleEl && titleEl.textContent.trim()) {
                        issueTitle = titleEl.textContent.trim();
                        break;
                    }
                }
                
                // Try different selectors for details elements
                const detailsCandidates = [
                    issueContainer.querySelector('.notification-message'),
                    issueContainer.querySelector('.issue-details'),
                    issueContainer.querySelector('p')
                ];
                
                for (const detailsEl of detailsCandidates) {
                    if (detailsEl && detailsEl.textContent.trim()) {
                        issueDetails = detailsEl.textContent.trim();
                        break;
                    }
                }
            }
            
            // Update the modal with issue details
            document.getElementById('fixNowIssueTitle').textContent = issueTitle;
            document.getElementById('fixNowIssueDetails').textContent = issueDetails;
            document.getElementById('fixProgressBar').style.width = '0%';
            document.getElementById('fixStatusText').textContent = 'Ready to begin fix process';
            document.getElementById('startFixButton').style.display = 'block';
            
            // Show the modal
            document.getElementById('fixNowModal').style.display = 'flex';
        }

        function handleNotifyTeamClick(button) {
            console.log("Notify Team button clicked", button); // Debug logging
            
            // Find the issue container - handle different possible parent structures
            const issueContainer = button.closest('.notification-item, .issue-item, .critical-issue') || 
                                   button.closest('[class*="issue"]') || 
                                   button.closest('section');
            
            let issueTitle = 'System Issue';
            let issueDetails = 'A system issue has been detected that requires team attention.';
            
            // Try to extract more specific issue details
            if (issueContainer) {
                // Try different selectors for title elements
                const titleCandidates = [
                    issueContainer.querySelector('.notification-title'),
                    issueContainer.querySelector('.issue-title'),
                    issueContainer.querySelector('h2'),
                    issueContainer.querySelector('h3'),
                    issueContainer.querySelector('strong')
                ];
                
                for (const titleEl of titleCandidates) {
                    if (titleEl && titleEl.textContent.trim()) {
                        issueTitle = titleEl.textContent.trim();
                        break;
                    }
                }
                
                // Try different selectors for details elements
                const detailsCandidates = [
                    issueContainer.querySelector('.notification-message'),
                    issueContainer.querySelector('.issue-details'),
                    issueContainer.querySelector('p')
                ];
                
                for (const detailsEl of detailsCandidates) {
                    if (detailsEl && detailsEl.textContent.trim()) {
                        issueDetails = detailsEl.textContent.trim();
                        break;
                    }
                }
            }
            
            // Update the modal with issue details
            document.getElementById('notifyTeamIssueTitle').textContent = issueTitle;
            document.getElementById('notifyTeamIssueDetails').textContent = issueDetails;
            document.getElementById('notificationMessage').value = '';
            document.getElementById('notifyProgressContainer').style.display = 'none';
            document.getElementById('notifyProgressBar').style.width = '0%';
            document.getElementById('notifyStatusText').textContent = '';
            document.getElementById('sendNotificationButton').style.display = 'block';
            
            // Show the modal
            document.getElementById('notifyTeamModal').style.display = 'flex';
        }

        // Simplify the DOMContentLoaded event handler
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing DOMContentLoaded code ...
            
            // Setup action buttons with the improved approach
            setupActionButtons();
        });

        // Special handling for the Critical Issues section with direct binding
        function setupCriticalIssueButtons() {
            const criticalSection = document.querySelector('.critical-issue') || 
                                   document.getElementById('critical-issues-summary') ||
                                   document.querySelector('[class*="critical"]');
                                   
            if (criticalSection) {
                const notifyButton = criticalSection.querySelector('button:nth-child(2)') || // Second button in container
                                    criticalSection.querySelector('button[class*="notify"]') ||
                                    criticalSection.querySelector('button');
                                    
                if (notifyButton) {
                    console.log("Found critical issue notify button:", notifyButton); // Debug
                    notifyButton.onclick = function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        handleNotifyTeamClick(notifyButton);
                        return false;
                    };
                }
            }
        }

        // Call this after DOM is fully loaded and periodically to catch dynamic content
        window.addEventListener('load', function() {
            setupActionButtons();
            setupCriticalIssueButtons();
            
            // Try again after a short delay to catch any dynamically created elements
            setTimeout(setupCriticalIssueButtons, 500);
            setTimeout(setupCriticalIssueButtons, 1000);
            setTimeout(setupCriticalIssueButtons, 2000);
        });

        function closeFixNowModal() {
            document.getElementById('fixNowModal').style.display = 'none';
        }

        function closeNotifyTeamModal() {
            document.getElementById('notifyTeamModal').style.display = 'none';
        }

        function startFixProcess() {
            // Hide the start button during the process
            document.getElementById('startFixButton').style.display = 'none';
            
            // Simulate a fix process with progress updates
            let progress = 0;
            const fixInterval = setInterval(() => {
                progress += 10;
                if (progress <= 100) {
                    document.getElementById('fixProgressBar').style.width = progress + '%';
                    
                    // Update status text based on progress
                    let statusText = 'Initializing fix...';
                    if (progress >= 30) statusText = 'Diagnosing issue...';
                    if (progress >= 50) statusText = 'Applying fix...';
                    if (progress >= 80) statusText = 'Verifying solution...';
                    if (progress >= 100) statusText = 'Fix completed successfully!';
                    
                    document.getElementById('fixStatusText').textContent = statusText;
                } else {
                    clearInterval(fixInterval);
                    
                    // After a small delay, close the modal
                    setTimeout(() => {
                        // Add a notification about the fix
                        addFixCompletedNotification(document.getElementById('fixNowIssueTitle').textContent);
                        closeFixNowModal();
                    }, 1500);
                }
            }, 500);
        }

        function sendTeamNotification() {
            // Get the notification details
            const issueTitle = document.getElementById('notifyTeamIssueTitle').textContent;
            const priority = document.getElementById('notificationPriority').value;
            const message = document.getElementById('notificationMessage').value;
            
            // Hide the send button during the process
            document.getElementById('sendNotificationButton').style.display = 'none';
            
            // Show progress container
            document.getElementById('notifyProgressContainer').style.display = 'block';
            
            // Simulate sending notification with progress updates
            let progress = 0;
            const notifyInterval = setInterval(() => {
                progress += 20;
                if (progress <= 100) {
                    document.getElementById('notifyProgressBar').style.width = progress + '%';
                    
                    // Update status text based on progress
                    let statusText = 'Preparing notification...';
                    if (progress >= 40) statusText = 'Identifying team members...';
                    if (progress >= 60) statusText = 'Sending notification...';
                    if (progress >= 80) statusText = 'Confirming delivery...';
                    if (progress >= 100) statusText = 'Notification sent successfully!';
                    
                    document.getElementById('notifyStatusText').textContent = statusText;
                } else {
                    clearInterval(notifyInterval);
                    
                    // After a small delay, close the modal
                    setTimeout(() => {
                        // Add a notification about the notification being sent
                        addNotificationSentConfirmation(issueTitle, priority);
                        closeNotifyTeamModal();
                    }, 1000);
                }
            }, 400);
        }

        function addFixCompletedNotification(issueTitle) {
            // Add a new notification to the bell dropdown instead of the notifications panel
            const headerNotificationList = document.querySelector('.header-notification-list');
            
            if (headerNotificationList) {
                const newNotification = document.createElement('div');
                newNotification.className = 'header-notification-item unread';
                newNotification.innerHTML = `
                    <div class="header-notification-icon" style="background-color: rgba(48, 209, 88, 0.1); color: #30d158;">‚úì</div>
                    <div class="header-notification-content">
                        <div class="header-notification-title">Fix Completed</div>
                        <div class="header-notification-message">
                            The issue "${issueTitle}" has been successfully resolved.
                        </div>
                        <div class="header-notification-time">Just now</div>
                    </div>
                `;
                
                // Add the new notification at the top
                headerNotificationList.insertBefore(newNotification, headerNotificationList.firstChild);
                
                // Show the notification badge
                const badge = document.querySelector('.notification-badge');
                if (badge) {
                    badge.style.display = 'block';
                }
            }
        }

        function addNotificationSentConfirmation(issueTitle, priority) {
            // Add a new notification to the bell dropdown instead of the notifications panel
            const headerNotificationList = document.querySelector('.header-notification-list');
            
            if (headerNotificationList) {
                const newNotification = document.createElement('div');
                newNotification.className = 'header-notification-item unread';
                newNotification.innerHTML = `
                    <div class="header-notification-icon" style="background-color: rgba(10, 132, 255, 0.1); color: #0a84ff;">üì®</div>
                    <div class="header-notification-content">
                        <div class="header-notification-title">Team Notification Sent</div>
                        <div class="header-notification-message">
                            Team has been notified about "${issueTitle}" with ${priority} priority.
                        </div>
                        <div class="header-notification-time">Just now</div>
                    </div>
                `;
                
                // Add the new notification at the top
                headerNotificationList.insertBefore(newNotification, headerNotificationList.firstChild);
                
                // Show the notification badge
                const badge = document.querySelector('.notification-badge');
                if (badge) {
                    badge.style.display = 'block';
                }
            }
        }

        // Add notification bell functionality
        document.addEventListener('DOMContentLoaded', function() {
            const notificationBell = document.getElementById('notificationBell');
            const notificationDropdown = document.getElementById('notificationDropdown');
            const markAllReadBtn = document.querySelector('.mark-all-read');
            
            // Toggle dropdown when bell is clicked
            if (notificationBell) {
                notificationBell.addEventListener('click', function(e) {
                    e.stopPropagation();
                    notificationDropdown.classList.toggle('show');
                });
            }
            
            // Mark all notifications as read
            if (markAllReadBtn) {
                markAllReadBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const unreadItems = document.querySelectorAll('.header-notification-item.unread');
                    unreadItems.forEach(item => {
                        item.classList.remove('unread');
                    });
                    document.querySelector('.notification-badge').style.display = 'none';
                });
            }
            
            // Close dropdown when clicking elsewhere
            document.addEventListener('click', function(e) {
                if (notificationDropdown && notificationDropdown.classList.contains('show') && 
                    !notificationDropdown.contains(e.target) && e.target !== notificationBell) {
                    notificationDropdown.classList.remove('show');
                }
            });
            
            // Prevent dropdown from closing when clicking inside it
            if (notificationDropdown) {
                notificationDropdown.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            }
        });

        // Function to handle deployment of updates
        function deployUpdate(software, version, devices, type) {
            // Set modal content
            document.getElementById('deploySoftware').textContent = software;
            document.getElementById('deployVersion').textContent = version;
            document.getElementById('deployDevices').textContent = devices;
            document.getElementById('deployType').textContent = type;
            
            // Reset modal state
            document.getElementById('deployUpdateContent').style.display = 'block';
            document.getElementById('deployProgressContainer').style.display = 'none';
            document.getElementById('deploySuccessContainer').style.display = 'none';
            document.getElementById('deployCancel').textContent = 'Cancel';
            document.getElementById('deployConfirm').style.display = 'inline-block';
            
            // Show modal
            const modal = document.getElementById('deployUpdateModal');
            modal.style.display = 'flex';
            setTimeout(() => {
                modal.style.opacity = '1';
            }, 10);
        }
        
        // Function to confirm deployment
        function confirmDeployment() {
            // Hide initial content
            document.getElementById('deployUpdateContent').style.display = 'none';
            document.getElementById('deployConfirm').style.display = 'none';
            document.getElementById('deployCancel').textContent = 'Close';
            
            // Show progress
            document.getElementById('deployProgressContainer').style.display = 'block';
            
            // Get deployment data
            const software = document.getElementById('deploySoftware').textContent;
            const schedule = document.getElementById('deploySchedule').value;
            
            // Simulate deployment progress
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('deployProgressBar').style.width = `${progress}%`;
                
                if (progress < 30) {
                    document.getElementById('deployStatusText').textContent = 'Preparing deployment...';
                    document.getElementById('deployDetailText').textContent = 'Validating update package and target devices';
                } else if (progress < 60) {
                    document.getElementById('deployStatusText').textContent = 'Configuring deployment...';
                    document.getElementById('deployDetailText').textContent = 'Setting up deployment schedule and options';
                } else if (progress < 90) {
                    document.getElementById('deployStatusText').textContent = 'Finalizing deployment...';
                    document.getElementById('deployDetailText').textContent = 'Creating deployment tasks and notifications';
                } else if (progress === 100) {
                    document.getElementById('deployStatusText').textContent = 'Deployment scheduled!';
                    document.getElementById('deployDetailText').textContent = 'All tasks have been created successfully';
                    
                    clearInterval(interval);
                    
                    // Show success after a brief delay
                    setTimeout(() => {
                        document.getElementById('deployProgressContainer').style.display = 'none';
                        document.getElementById('deploySuccessContainer').style.display = 'block';
                        
                        // Set success message based on schedule
                        let scheduleText = '';
                        switch(schedule) {
                            case 'immediate':
                                scheduleText = 'immediately';
                                break;
                            case 'night':
                                scheduleText = 'tonight at 2:00 AM';
                                break;
                            case 'weekend':
                                scheduleText = 'this weekend (Saturday at 2:00 AM)';
                                break;
                            case 'custom':
                                scheduleText = 'according to your custom schedule';
                                break;
                        }
                        
                        document.getElementById('deploySuccessMessage').textContent = `The update for ${software} will be deployed ${scheduleText}.`;
                    }, 500);
                }
            }, 200);
        }
        
        // Function to close deployment modal
        function closeDeployModal() {
            const modal = document.getElementById('deployUpdateModal');
            modal.style.opacity = '0';
            setTimeout(() => {
                modal.style.display = 'none';
            }, 300);
        }
    </script>
    <script src="ai-chat-widget.js"></script>

    <!-- Action Modal -->
    <div class="admin-key-modal" id="actionModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 class="modal-title" id="actionModalTitle">Fixing Issue</h3>
                <button onclick="closeActionModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            </div>
            <p class="modal-description" id="actionModalMessage">Starting automated fix process...</p>
            
            <div id="actionModalSteps" style="margin: 20px 0;"></div>
            
            <div style="background: #2c2c2e; border-radius: 8px; height: 6px; overflow: hidden; margin: 24px 0;" id="actionModalProgress">
                <div id="actionModalProgressBar" style="height: 100%; width: 0%; background: #2d7aff; transition: width 0.3s ease;"></div>
            </div>
            
            <div style="text-align: right;">
                <button id="actionModalCloseBtn" style="background: #3a3a3c; color: #f5f5f7; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 14px; display: none;">Close</button>
            </div>
        </div>
    </div>

    <!-- Action Modals (Add this near the end of the body, before the closing body tag) -->
    <div class="admin-key-modal" id="fixNowModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="modal-title">Fix Issue</h3>
            <button onclick="closeFixNowModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            <div style="margin: 20px 0;">
                <div id="fixNowIssueTitle" style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Issue Title</div>
                <div id="fixNowIssueDetails" style="margin-bottom: 15px; font-size: 14px;">Issue details will appear here.</div>
                <div style="margin-top: 20px;">
                    <div class="progress-container" style="height: 5px; background-color: #2c2c2e; border-radius: 3px; margin-bottom: 10px;">
                        <div id="fixProgressBar" class="progress-bar" style="width: 0%; height: 100%; background-color: #0A84FF; border-radius: 3px; transition: width 0.3s ease-in-out;"></div>
                    </div>
                    <div id="fixStatusText" style="font-size: 13px; color: #86868b;">Ready to begin fix process</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button cancel-button" onclick="closeFixNowModal()">Cancel</button>
                <button class="modal-button confirm-button" id="startFixButton" onclick="startFixProcess()">Start Fix</button>
            </div>
        </div>
    </div>

    <div class="admin-key-modal" id="notifyTeamModal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <h3 class="modal-title">Notify Team</h3>
            <button onclick="closeNotifyTeamModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            <div style="margin: 20px 0;">
                <div id="notifyTeamIssueTitle" style="font-weight: bold; margin-bottom: 10px; font-size: 16px;">Issue Title</div>
                <div id="notifyTeamIssueDetails" style="margin-bottom: 15px; font-size: 14px;">Issue details will appear here.</div>
                
                <div style="margin-top: 15px; margin-bottom: 15px;">
                    <label for="notificationPriority" style="display: block; margin-bottom: 5px; font-size: 14px;">Priority:</label>
                    <select id="notificationPriority" style="width: 100%; padding: 8px; background-color: #1c1c1e; color: #f5f5f7; border: 1px solid #3c3c3e; border-radius: 5px;">
                        <option value="high">High Priority</option>
                        <option value="medium" selected>Medium Priority</option>
                        <option value="low">Low Priority</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 15px;">
                    <label for="notificationMessage" style="display: block; margin-bottom: 5px; font-size: 14px;">Additional Message:</label>
                    <textarea id="notificationMessage" style="width: 100%; min-height: 80px; padding: 8px; background-color: #1c1c1e; color: #f5f5f7; border: 1px solid #3c3c3e; border-radius: 5px; resize: vertical;" placeholder="Add any specific instructions or context for the team..."></textarea>
                </div>

                <div id="notifyProgressContainer" style="display: none; margin-top: 20px;">
                    <div class="progress-container" style="height: 5px; background-color: #2c2c2e; border-radius: 3px; margin-bottom: 10px;">
                        <div id="notifyProgressBar" class="progress-bar" style="width: 0%; height: 100%; background-color: #0A84FF; border-radius: 3px; transition: width 0.3s ease-in-out;"></div>
                    </div>
                    <div id="notifyStatusText" style="font-size: 13px; color: #86868b;">Preparing notification...</div>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="modal-button cancel-button" onclick="closeNotifyTeamModal()">Cancel</button>
                <button class="modal-button confirm-button" id="sendNotificationButton" onclick="sendTeamNotification()">Send Notification</button>
            </div>
        </div>
    </div>

    <!-- Deploy Update Modal -->
    <div class="admin-key-modal" id="deployUpdateModal" style="display: none; opacity: 0;">
        <div class="modal-content" style="max-width: 500px; margin: 0; transform: translateY(0);">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3 class="modal-title" id="deployUpdateTitle">Deploy Update</h3>
                <button onclick="closeDeployModal()" style="background: none; border: none; font-size: 20px; color: #f5f5f7; cursor: pointer;">√ó</button>
            </div>
            
            <div id="deployUpdateContent">
                <div style="margin-bottom: 20px;">
                    <div style="font-size: 15px; color: #f5f5f7; margin-bottom: 8px;">You are about to deploy the following update:</div>
                    <div style="background: #2c2c2e; border-radius: 8px; padding: 16px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #86868b;">Software:</span>
                            <span style="color: #f5f5f7; font-weight: 500;" id="deploySoftware"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #86868b;">Version:</span>
                            <span style="color: #f5f5f7; font-weight: 500;" id="deployVersion"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                            <span style="color: #86868b;">Affected Devices:</span>
                            <span style="color: #f5f5f7; font-weight: 500;" id="deployDevices"></span>
                        </div>
                        <div style="display: flex; justify-content: space-between;">
                            <span style="color: #86868b;">Update Type:</span>
                            <span style="color: #f5f5f7; font-weight: 500;" id="deployType"></span>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Deployment Schedule</label>
                    <select id="deploySchedule" style="width: 100%; padding: 12px; border-radius: 8px; border: none; background: #3a3a3c; color: #f5f5f7;">
                        <option value="immediate">Deploy Immediately</option>
                        <option value="night" selected>Tonight (2:00 AM)</option>
                        <option value="weekend">Weekend (Saturday 2:00 AM)</option>
                        <option value="custom">Custom Schedule</option>
                    </select>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; font-size: 14px; color: #86868b; margin-bottom: 8px;">Deployment Options</label>
                    <div style="background: #2c2c2e; border-radius: 8px; padding: 16px;">
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <input type="checkbox" id="notifyUsers" checked style="margin-right: 8px;">
                            <label for="notifyUsers" style="color: #f5f5f7; font-size: 14px;">Notify users before deployment</label>
                        </div>
                        <div style="display: flex; align-items: center; margin-bottom: 12px;">
                            <input type="checkbox" id="forceRestart" style="margin-right: 8px;">
                            <label for="forceRestart" style="color: #f5f5f7; font-size: 14px;">Force restart if required</label>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <input type="checkbox" id="rollbackOnFailure" checked style="margin-right: 8px;">
                            <label for="rollbackOnFailure" style="color: #f5f5f7; font-size: 14px;">Automatic rollback on failure</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="deployProgressContainer" style="display: none; margin-bottom: 20px;">
                <div style="font-size: 16px; color: #f5f5f7; margin-bottom: 12px; text-align: center;" id="deployStatusText">Preparing deployment...</div>
                <div style="height: 8px; background: #3a3a3c; border-radius: 4px; overflow: hidden; margin-bottom: 16px;">
                    <div id="deployProgressBar" style="height: 100%; width: 0%; background: linear-gradient(to right, #2d7aff, #2260d2); transition: width 0.3s ease;"></div>
                </div>
                <div style="font-size: 14px; color: #86868b; text-align: center;" id="deployDetailText"></div>
            </div>
            
            <div id="deploySuccessContainer" style="display: none; margin-bottom: 20px; text-align: center;">
                <div style="width: 60px; height: 60px; background: rgba(48, 209, 88, 0.1); border-radius: 50%; margin: 0 auto 16px; display: flex; align-items: center; justify-content: center;">
                    <span style="color: #30d158; font-size: 30px;">‚úì</span>
                </div>
                <div style="font-size: 18px; color: #f5f5f7; margin-bottom: 8px;">Deployment Scheduled Successfully</div>
                <div style="font-size: 14px; color: #86868b;" id="deploySuccessMessage"></div>
            </div>
            
            <div class="modal-buttons" style="display: flex; justify-content: flex-end; gap: 12px;">
                <button onclick="closeDeployModal()" class="action-button" id="deployCancel">Cancel</button>
                <button onclick="confirmDeployment()" class="action-button primary" id="deployConfirm">Deploy Update</button>
            </div>
        </div>
    </div>
</body>
</html> 